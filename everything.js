// i dont know anything about global functions or something so i made all the code in 1 place
//Credits (in the weirdest place as possible):
//Naruyoko for ExpantaNum.js ( the thing from line 5 to line 1777 )

;(function (globalScope) {
  "use strict";


  // --  EDITABLE DEFAULTS  -- //
    var ExpantaNum = {

      // The maximum number of operators stored in array.
      // If the number of operations exceed the limit, then the least significant operations will be discarded.
      // This is to prevent long loops and eating away of memory and processing time.
      // 1000 means there are at maximum of 1000 elements in array.
      // It is not recommended to make this number too big.
      // `ExpantaNum.maxOps = 1000;`
      maxOps: 1e4,

      // Specify what format is used when serializing for JSON.stringify
      // 
      // JSON   0 JSON object
      // STRING 1 String
      serializeMode: 0,
      
      // Level of debug information printed in console
      // 
      // NONE   0 Show no information.
      // NORMAL 1 Show operations.
      // ALL    2 Show everything.
      debug: 0
    },


  // -- END OF EDITABLE DEFAULTS -- //


    external = true,

    expantaNumError = "[ExpantaNumError] ",
    invalidArgument = expantaNumError + "Invalid argument: ",

    isExpantaNum = /^[-\+]*(Infinity|NaN|(J+|J\^\d+ )?(10(\^+|\{[1-9]\d*\})|\(10(\^+|\{[1-9]\d*\})\)\^[1-9]\d* )*((\d+(\.\d*)?|\d*\.\d+)?([Ee][-\+]*))*(0|\d+(\.\d*)?|\d*\.\d+))$/,

    MAX_SAFE_INTEGER = 9007199254740991,
    MAX_E = Math.log10(MAX_SAFE_INTEGER), //15.954589770191003

    // ExpantaNum.prototype object
    P={},
    // ExpantaNum static object
    Q={},
    // ExpantaNum constants
    R={};

  // ExpantaNum prototype methods

  /*
   *  absoluteValue             abs
   *  affordArithmeticSeries
   *  affordGeometricSeries
   *  arrow
   *  ceiling                   ceil
   *  chain
   *  choose
   *  comparedTo                cmp
   *  cubeRoot                  cbrt
   *  divide                    div
   *  equals                    eq
   *  expansion
   *  exponential               exp
   *  factorial                 fact
   *  floor
   *  gamma
   *  generalLogarithm          log10
   *  greaterThan               gt
   *  greaterThanOrEqualTo      gte
   *  hyper
   *  isFinite
   *  isInfinite
   *  isInteger                 isint
   *  isNaN
   *  isNegative                isneg
   *  isPositive                ispos
   *  iteratedexp
   *  iteratedlog
   *  lambertw
   *  layeradd
   *  layeradd10
   *  lessThan                  lt
   *  lessThanOrEqualTo         lte
   *  logarithm                 logBase
   *  minus                     sub
   *  modulo                    mod
   *  naturalLogarithm          ln        log
   *  negated                   neg
   *  notequals                 neq
   *  pentate                   pent
   *  plus                      add
   *  reciprocate               rec
   *  root
   *  round
   *  slog
   *  squareRoot                sqrt
   *  ssqrt                     ssrt
   *  sumArithmeticSeries
   *  sumGeometricSeries
   *  times                     mul
   *  tetrate                   tetr
   *  toExponential
   *  toFixed
   *  toHyperE
   *  toJSON
   *  toNumber
   *  toPower                   pow
   *  toPrecision
   *  toString
   *  toStringWithDecimalPlaces
   *  valueOf
   */
  R.ZERO=0;
  R.ONE=1;
  R.E=Math.E;
  R.LN2=Math.LN2;
  R.LN10=Math.LN10;
  R.LOG2E=Math.LOG2E;
  R.LOG10E=Math.LOG10E;
  R.PI=Math.PI;
  R.SQRT1_2=Math.SQRT1_2;
  R.SQRT2=Math.SQRT2;
  R.MAX_SAFE_INTEGER=MAX_SAFE_INTEGER;
  R.MIN_SAFE_INTEGER=Number.MIN_SAFE_INTEGER;
  R.NaN=Number.NaN;
  R.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY;
  R.POSITIVE_INFINITY=Number.POSITIVE_INFINITY;
  R.E_MAX_SAFE_INTEGER="e"+MAX_SAFE_INTEGER;
  R.EE_MAX_SAFE_INTEGER="ee"+MAX_SAFE_INTEGER;
  R.TETRATED_MAX_SAFE_INTEGER="10^^"+MAX_SAFE_INTEGER;
  R.GRAHAMS_NUMBER="J^63 10^^^(10^)^7625597484984 3638334640023.7783";
  P.absoluteValue=P.abs=function(){
    var x=this.clone();
    x.sign=1;
    return x;
  };
  Q.absoluteValue=Q.abs=function(x){
    return new ExpantaNum(x).abs();
  };
  P.negate=P.neg=function (){
    var x=this.clone();
    x.sign=x.sign*-1;
    return x;
  };
  Q.negate=Q.neg=function (x){
    return new ExpantaNum(x).neg();
  };
  P.compareTo=P.cmp=function (other){
    if (!(other instanceof ExpantaNum)) other=new ExpantaNum(other);
    if (isNaN(this.array[0][1])||isNaN(other.array[0][1])) return NaN;
    if (this.array[0][1]==Infinity&&other.array[0][1]!=Infinity) return this.sign;
    if (this.array[0][1]!=Infinity&&other.array[0][1]==Infinity) return -other.sign;
    if (this.array.length==1&&this.array[0][1]===0&&other.array.length==1&&other.array[0][1]===0) return 0;
    if (this.sign!=other.sign) return this.sign;
    var m=this.sign;
    var r;
    if (this.layer>other.layer) r=1;
    else if (this.layer<other.layer) r=-1;
    else{
      var e,f;
      for (var i=0,l=Math.min(this.array.length,other.array.length);i<l;++i){
        e=this.array[this.array.length-1-i];
        f=other.array[other.array.length-1-i];
        if (e[0]>f[0]||e[0]==f[0]&&e[1]>f[1]){
          r=1;
          break;
        }else if (e[0]<f[0]||e[0]==f[0]&&e[1]<f[1]){
          r=-1;
          break;
        }
      }
      if (r===undefined){
        if (this.array.length==other.array.length){
          r=0;
        }else if (this.array.length>other.array.length){
          e=this.array[this.array.length-l];
          if (e[0]>=1||e[1]>10){
            r=1;
          }else{
            r=-1;
          }
        }else{
          e=other.array[other.array.length-l];
          if (e[0]>=1||e[1]>10){
            r=-1;
          }else{
            r=1;
          }
        }
      }
    }
    return r*m;
  };
  Q.compare=Q.cmp=function (x,y){
    return new ExpantaNum(x).cmp(y);
  };
  P.greaterThan=P.gt=function (other){
    return this.cmp(other)>0;
  };
  Q.greaterThan=Q.gt=function (x,y){
    return new ExpantaNum(x).gt(y);
  };
  P.greaterThanOrEqualTo=P.gte=function (other){
    return this.cmp(other)>=0;
  };
  Q.greaterThanOrEqualTo=Q.gte=function (x,y){
    return new ExpantaNum(x).gte(y);
  };
  P.lessThan=P.lt=function (other){
    return this.cmp(other)<0;
  };
  Q.lessThan=Q.lt=function (x,y){
    return new ExpantaNum(x).lt(y);
  };
  P.lessThanOrEqualTo=P.lte=function (other){
    return this.cmp(other)<=0;
  };
  Q.lessThanOrEqualTo=Q.lte=function (x,y){
    return new ExpantaNum(x).lte(y);
  };
  P.equalsTo=P.equal=P.eq=function (other){
    return this.cmp(other)===0;
  };
  Q.equalsTo=Q.equal=Q.eq=function (x,y){
    return new ExpantaNum(x).eq(y);
  };
  P.notEqualsTo=P.notEqual=P.neq=function (other){
    return this.cmp(other)!==0;
  };
  Q.notEqualsTo=Q.notEqual=Q.neq=function (x,y){
    return new ExpantaNum(x).neq(y);
  };
  P.minimum=P.min=function (other){
    return this.lt(other)?this.clone():new ExpantaNum(other);
  };
  Q.minimum=Q.min=function (x,y){
    return new ExpantaNum(x).min(y);
  };
  P.maximum=P.max=function (other){
    return this.gt(other)?this.clone():new ExpantaNum(other);
  };
  Q.maximum=Q.max=function (x,y){
    return new ExpantaNum(x).max(y);
  };
  P.isPositive=P.ispos=function (){
    return this.gt(ExpantaNum.ZERO);
  };
  Q.isPositive=Q.ispos=function (x){
    return new ExpantaNum(x).ispos();
  };
  P.isNegative=P.isneg=function (){
    return this.lt(ExpantaNum.ZERO);
  };
  Q.isNegative=Q.isneg=function (x){
    return new ExpantaNum(x).isneg();
  };
  P.isNaN=function (){
    return isNaN(this.array[0][1]);
  };
  Q.isNaN=function (x){
    return new ExpantaNum(x).isNaN();
  };
  P.isFinite=function (){
    return isFinite(this.array[0][1]);
  };
  Q.isFinite=function (x){
    return new ExpantaNum(x).isFinite();
  };
  P.isInfinite=function (){
    return this.array[0][1]==Infinity;
  };
  Q.isInfinite=function (x){
    return new ExpantaNum(x).isInfinite();
  };
  P.isInteger=P.isint=function (){
    if (this.sign==-1) return this.abs().isint();
    if (this.gt(ExpantaNum.MAX_SAFE_INTEGER)) return true;
    return Number.isInteger(this.toNumber());
  };
  Q.isInteger=Q.isint=function (x){
    return new ExpantaNum(x).isint();
  };
  P.floor=function (){
    if (this.isInteger()) return this.clone();
    return new ExpantaNum(Math.floor(this.toNumber()));
  };
  Q.floor=function (x){
    return new ExpantaNum(x).floor();
  };
  P.ceiling=P.ceil=function (){
    if (this.isInteger()) return this.clone();
    return new ExpantaNum(Math.ceil(this.toNumber()));
  };
  Q.ceiling=Q.ceil=function (x){
    return new ExpantaNum(x).ceil();
  };
  P.round=function (){
    if (this.isInteger()) return this.clone();
    return new ExpantaNum(Math.round(this.toNumber()));
  };
  Q.round=function (x){
    return new ExpantaNum(x).round();
  };
  P.plus=P.add=function (other){
    var x=this.clone();
    other=new ExpantaNum(other);
    if (ExpantaNum.debug>=ExpantaNum.NORMAL) console.log(this+"+"+other);
    if (x.sign==-1) return x.neg().add(other.neg()).neg();
    if (other.sign==-1) return x.sub(other.neg());
    if (x.eq(ExpantaNum.ZERO)) return other;
    if (other.eq(ExpantaNum.ZERO)) return x;
    if (x.isNaN()||other.isNaN()||x.isInfinite()&&other.isInfinite()&&x.eq(other.neg())) return ExpantaNum.NaN.clone();
    if (x.isInfinite()) return x;
    if (other.isInfinite()) return other;
    var p=x.min(other);
    var q=x.max(other);
    var op0=q.operator(0);
    var op1=q.operator(1);
    var t;
    if (q.gt(ExpantaNum.E_MAX_SAFE_INTEGER)||q.div(p).gt(ExpantaNum.MAX_SAFE_INTEGER)){
      t=q;
    }else if (!op1){
      t=new ExpantaNum(x.toNumber()+other.toNumber());
    }else if (op1==1){
      var a=p.operator(1)?p.operator(0):Math.log10(p.operator(0));
      t=new ExpantaNum([a+Math.log10(Math.pow(10,op0-a)+1),1]);
    }
    p=q=null;
    return t;
  };
  Q.plus=Q.add=function (x,y){
    return new ExpantaNum(x).add(y);
  };
  P.minus=P.sub=function (other){
    var x=this.clone();
    other=new ExpantaNum(other);
    if (ExpantaNum.debug>=ExpantaNum.NORMAL) console.log(x+"-"+other);
    if (x.sign==-1) return x.neg().sub(other.neg()).neg();
    if (other.sign==-1) return x.add(other.neg());
    if (x.eq(other)) return ExpantaNum.ZERO.clone();
    if (other.eq(ExpantaNum.ZERO)) return x;
    if (x.isNaN()||other.isNaN()||x.isInfinite()&&other.isInfinite()) return ExpantaNum.NaN.clone();
    if (x.isInfinite()) return x;
    if (other.isInfinite()) return other.neg();
    var p=x.min(other);
    var q=x.max(other);
    var n=other.gt(x);
    var op0=q.operator(0);
    var op1=q.operator(1);
    var t;
    if (q.gt(ExpantaNum.E_MAX_SAFE_INTEGER)||q.div(p).gt(ExpantaNum.MAX_SAFE_INTEGER)){
      t=q;
      t=n?t.neg():t;
    }else if (!op1){
      t=new ExpantaNum(x.toNumber()-other.toNumber());
    }else if (op1==1){
      var a=p.operator(1)?p.operator(0):Math.log10(p.operator(0));
      t=new ExpantaNum([a+Math.log10(Math.pow(10,op0-a)-1),1]);
      t=n?t.neg():t;
    }
    p=q=null;
    return t;
  };
  Q.minus=Q.sub=function (x,y){
    return new ExpantaNum(x).sub(y);
  };
  P.times=P.mul=function (other){
    var x=this.clone();
    other=new ExpantaNum(other);
    if (ExpantaNum.debug>=ExpantaNum.NORMAL) console.log(x+"*"+other);
    if (x.sign*other.sign==-1) return x.abs().mul(other.abs()).neg();
    if (x.sign==-1) return x.abs().mul(other.abs());
    if (x.isNaN()||other.isNaN()||x.eq(ExpantaNum.ZERO)&&other.isInfinite()||x.isInfinite()&&other.abs().eq(ExpantaNum.ZERO)) return ExpantaNum.NaN.clone();
    if (other.eq(ExpantaNum.ZERO)) return ExpantaNum.ZERO.clone();
    if (other.eq(ExpantaNum.ONE)) return x.clone();
    if (x.isInfinite()) return x;
    if (other.isInfinite()) return other;
    if (x.max(other).gt(ExpantaNum.EE_MAX_SAFE_INTEGER)) return x.max(other);
    var n=x.toNumber()*other.toNumber();
    if (n<=MAX_SAFE_INTEGER) return new ExpantaNum(n);
    return ExpantaNum.pow(10,x.log10().add(other.log10()));
  };
  Q.times=Q.mul=function (x,y){
    return new ExpantaNum(x).mul(y);
  };
  P.divide=P.div=function (other){
    var x=this.clone();
    other=new ExpantaNum(other);
    if (ExpantaNum.debug>=ExpantaNum.NORMAL) console.log(x+"/"+other);
    if (x.sign*other.sign==-1) return x.abs().div(other.abs()).neg();
    if (x.sign==-1) return x.abs().div(other.abs());
    if (x.isNaN()||other.isNaN()||x.isInfinite()&&other.isInfinite()||x.eq(ExpantaNum.ZERO)&&other.eq(ExpantaNum.ZERO)) return ExpantaNum.NaN.clone();
    if (other.eq(ExpantaNum.ZERO)) return ExpantaNum.POSITIVE_INFINITY.clone();
    if (other.eq(ExpantaNum.ONE)) return x.clone();
    if (x.eq(other)) return ExpantaNum.ONE.clone();
    if (x.isInfinite()) return x;
    if (other.isInfinite()) return ExpantaNum.ZERO.clone();
    if (x.max(other).gt(ExpantaNum.EE_MAX_SAFE_INTEGER)) return x.gt(other)?x.clone():ExpantaNum.ZERO.clone();
    var n=x.toNumber()/other.toNumber();
    if (n<=MAX_SAFE_INTEGER) return new ExpantaNum(n);
    var pw=ExpantaNum.pow(10,x.log10().sub(other.log10()));
    var fp=pw.floor();
    if (pw.sub(fp).lt(new ExpantaNum(1e-9))) return fp;
    return pw;
  };
  Q.divide=Q.div=function (x,y){
    return new ExpantaNum(x).div(y);
  };
  P.reciprocate=P.rec=function (){
    if (ExpantaNum.debug>=ExpantaNum.NORMAL) console.log(this+"^-1");
    if (this.isNaN()||this.eq(ExpantaNum.ZERO)) return ExpantaNum.NaN.clone();
    if (this.abs().gt("2e323")) return ExpantaNum.ZERO.clone();
    return new ExpantaNum(1/this);
  };
  Q.reciprocate=Q.rec=function (x){
    return new ExpantaNum(x).rec();
  };
  P.modular=P.mod=function (other){
    other=new ExpantaNum(other);
    if (other.eq(ExpantaNum.ZERO)) return ExpantaNum.ZERO.clone();
    if (this.sign*other.sign==-1) return this.abs().mod(other.abs()).neg();
    if (this.sign==-1) return this.abs().mod(other.abs());
    return this.sub(this.div(other).floor().mul(other));
  };
  Q.modular=Q.mod=function (x,y){
    return new ExpantaNum(x).mod(y);
  };
  //All of these are from Patashu's break_eternity.js
  //from HyperCalc source code
  var f_gamma=function (n){
    if (!isFinite(n)) return n;
    if (n<-50){
      if (n==Math.trunc(n)) return Number.NEGATIVE_INFINITY;
      return 0;
    }
    var scal1=1;
    while (n<10){
      scal1=scal1*n;
      ++n;
    }
    n-=1;
    var l=0.9189385332046727; //0.5*Math.log(2*Math.PI)
    l+=(n+0.5)*Math.log(n);
    l-=n;
    var n2=n*n;
    var np=n;
    l+=1/(12*np);
    np*=n2;
    l+=1/(360*np);
    np*=np*n2;
    l+=1/(1260*np);
    np*=n2;
    l+=1/(1680*np);
    np*=n2;
    l+=1/(1188*np);
    np*=n2;
    l+=691/(360360*np);
    np*=n2;
    l+=7/(1092*np);
    np*=n2;
    l+=3617/(122400*np);
    return Math.exp(l)/scal1;
  };
  //from HyperCalc source code
  P.gamma=function (){
    var x=this.clone();
    if (x.gt(ExpantaNum.TETRATED_MAX_SAFE_INTEGER)) return x;
    if (x.gt(ExpantaNum.E_MAX_SAFE_INTEGER)) return ExpantaNum.exp(x);
    if (x.gt(ExpantaNum.MAX_SAFE_INTEGER)) return ExpantaNum.exp(ExpantaNum.mul(x,ExpantaNum.ln(x).sub(1)));
    var n=x.operator(0);
    if (n>1){
      if (n<24) return new ExpantaNum(f_gamma(x.sign*n));
      var t=n-1;
      var l=0.9189385332046727; //0.5*Math.log(2*Math.PI)
      l+=((t+0.5)*Math.log(t));
      l-=t;
      var n2=t*t;
      var np=t;
      var lm=12*np;
      var adj=1/lm;
      var l2=l+adj;
      if (l2==l) return ExpantaNum.exp(l);
      l=l2;
      np*=n2;
      lm=360*np;
      adj=1/lm;
      l2=l-adj;
      if (l2==l) return ExpantaNum.exp(l);
      l=l2;
      np*=n2;
      lm=1260*np;
      var lt=1/lm;
      l+=lt;
      np*=n2;
      lm=1680*np;
      lt=1/lm;
      l-=lt;
      return ExpantaNum.exp(l);
    }else return this.rec();
  };
  Q.gamma=function (x){
    return new ExpantaNum(x).gamma();
  };
  //end break_eternity.js excerpt
  Q.factorials=[1, 1, 2, 6, 24, 120, 720, 5040, 40320, 362880, 3628800, 39916800, 479001600, 6227020800, 87178291200, 1307674368000, 20922789888000, 355687428096000, 6402373705728000, 121645100408832000, 2432902008176640000, 51090942171709440000, 1124000727777607680000, 25852016738884976640000, 620448401733239439360000, 15511210043330985984000000, 403291461126605635584000000, 10888869450418352160768000000, 304888344611713860501504000000, 8841761993739701954543616000000, 265252859812191058636308480000000, 8222838654177922817725562880000000, 263130836933693530167218012160000000, 8683317618811886495518194401280000000, 295232799039604140847618609643520000000, 10333147966386144929666651337523200000000, 371993326789901217467999448150835200000000, 13763753091226345046315979581580902400000000, 523022617466601111760007224100074291200000000, 20397882081197443358640281739902897356800000000, 815915283247897734345611269596115894272000000000, 33452526613163807108170062053440751665152000000000, 1405006117752879898543142606244511569936384000000000, 60415263063373835637355132068513997507264512000000000, 2658271574788448768043625811014615890319638528000000000, 119622220865480194561963161495657715064383733760000000000, 5502622159812088949850305428800254892961651752960000000000, 258623241511168180642964355153611979969197632389120000000000, 12413915592536072670862289047373375038521486354677760000000000, 608281864034267560872252163321295376887552831379210240000000000, 30414093201713378043612608166064768844377641568960512000000000000, 1551118753287382280224243016469303211063259720016986112000000000000, 80658175170943878571660636856403766975289505440883277824000000000000, 4274883284060025564298013753389399649690343788366813724672000000000000, 230843697339241380472092742683027581083278564571807941132288000000000000, 12696403353658275925965100847566516959580321051449436762275840000000000000, 710998587804863451854045647463724949736497978881168458687447040000000000000, 40526919504877216755680601905432322134980384796226602145184481280000000000000, 2350561331282878571829474910515074683828862318181142924420699914240000000000000, 138683118545689835737939019720389406345902876772687432540821294940160000000000000, 8320987112741390144276341183223364380754172606361245952449277696409600000000000000, 507580213877224798800856812176625227226004528988036003099405939480985600000000000000, 31469973260387937525653122354950764088012280797258232192163168247821107200000000000000, 1982608315404440064116146708361898137544773690227268628106279599612729753600000000000000, 126886932185884164103433389335161480802865516174545192198801894375214704230400000000000000, 8247650592082470666723170306785496252186258551345437492922123134388955774976000000000000000, 544344939077443064003729240247842752644293064388798874532860126869671081148416000000000000000, 36471110918188685288249859096605464427167635314049524593701628500267962436943872000000000000000, 2480035542436830599600990418569171581047399201355367672371710738018221445712183296000000000000000, 171122452428141311372468338881272839092270544893520369393648040923257279754140647424000000000000000, 11978571669969891796072783721689098736458938142546425857555362864628009582789845319680000000000000000, 850478588567862317521167644239926010288584608120796235886430763388588680378079017697280000000000000000, 61234458376886086861524070385274672740778091784697328983823014963978384987221689274204160000000000000000, 4470115461512684340891257138125051110076800700282905015819080092370422104067183317016903680000000000000000, 330788544151938641225953028221253782145683251820934971170611926835411235700971565459250872320000000000000000, 24809140811395398091946477116594033660926243886570122837795894512655842677572867409443815424000000000000000000, 1885494701666050254987932260861146558230394535379329335672487982961844043495537923117729972224000000000000000000, 145183092028285869634070784086308284983740379224208358846781574688061991349156420080065207861248000000000000000000, 11324281178206297831457521158732046228731749579488251990048962825668835325234200766245086213177344000000000000000000, 894618213078297528685144171539831652069808216779571907213868063227837990693501860533361810841010176000000000000000000, 71569457046263802294811533723186532165584657342365752577109445058227039255480148842668944867280814080000000000000000000, 5797126020747367985879734231578109105412357244731625958745865049716390179693892056256184534249745940480000000000000000000, 475364333701284174842138206989404946643813294067993328617160934076743994734899148613007131808479167119360000000000000000000, 39455239697206586511897471180120610571436503407643446275224357528369751562996629334879591940103770870906880000000000000000000, 3314240134565353266999387579130131288000666286242049487118846032383059131291716864129885722968716753156177920000000000000000000, 281710411438055027694947944226061159480056634330574206405101912752560026159795933451040286452340924018275123200000000000000000000, 24227095383672732381765523203441259715284870552429381750838764496720162249742450276789464634901319465571660595200000000000000000000, 2107757298379527717213600518699389595229783738061356212322972511214654115727593174080683423236414793504734471782400000000000000000000, 185482642257398439114796845645546284380220968949399346684421580986889562184028199319100141244804501828416633516851200000000000000000000, 16507955160908461081216919262453619309839666236496541854913520707833171034378509739399912570787600662729080382999756800000000000000000000, 1485715964481761497309522733620825737885569961284688766942216863704985393094065876545992131370884059645617234469978112000000000000000000000, 135200152767840296255166568759495142147586866476906677791741734597153670771559994765685283954750449427751168336768008192000000000000000000000, 12438414054641307255475324325873553077577991715875414356840239582938137710983519518443046123837041347353107486982656753664000000000000000000000, 1156772507081641574759205162306240436214753229576413535186142281213246807121467315215203289516844845303838996289387078090752000000000000000000000, 108736615665674308027365285256786601004186803580182872307497374434045199869417927630229109214583415458560865651202385340530688000000000000000000000, 10329978488239059262599702099394727095397746340117372869212250571234293987594703124871765375385424468563282236864226607350415360000000000000000000000, 991677934870949689209571401541893801158183648651267795444376054838492222809091499987689476037000748982075094738965754305639874560000000000000000000000, 96192759682482119853328425949563698712343813919172976158104477319333745612481875498805879175589072651261284189679678167647067832320000000000000000000000, 9426890448883247745626185743057242473809693764078951663494238777294707070023223798882976159207729119823605850588608460429412647567360000000000000000000000, 933262154439441526816992388562667004907159682643816214685929638952175999932299156089414639761565182862536979208272237582511852109168640000000000000000000000, 93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000, 9425947759838359420851623124482936749562312794702543768327889353416977599316221476503087861591808346911623490003549599583369706302603264000000000000000000000000, 961446671503512660926865558697259548455355905059659464369444714048531715130254590603314961882364451384985595980362059157503710042865532928000000000000000000000000, 99029007164861804075467152545817733490901658221144924830052805546998766658416222832141441073883538492653516385977292093222882134415149891584000000000000000000000000, 10299016745145627623848583864765044283053772454999072182325491776887871732475287174542709871683888003235965704141638377695179741979175588724736000000000000000000000000, 1081396758240290900504101305800329649720646107774902579144176636573226531909905153326984536526808240339776398934872029657993872907813436816097280000000000000000000000000, 114628056373470835453434738414834942870388487424139673389282723476762012382449946252660360871841673476016298287096435143747350528228224302506311680000000000000000000000000, 12265202031961379393517517010387338887131568154382945052653251412013535324922144249034658613287059061933743916719318560380966506520420000368175349760000000000000000000000000, 1324641819451828974499891837121832599810209360673358065686551152497461815091591578895743130235002378688844343005686404521144382704205360039762937774080000000000000000000000000, 144385958320249358220488210246279753379312820313396029159834075622223337844983482099636001195615259277084033387619818092804737714758384244334160217374720000000000000000000000000, 15882455415227429404253703127090772871724410234473563207581748318444567162948183030959960131517678520479243672638179990208521148623422266876757623911219200000000000000000000000000, 1762952551090244663872161047107075788761409536026565516041574063347346955087248316436555574598462315773196047662837978913145847497199871623320096254145331200000000000000000000000000, 197450685722107402353682037275992488341277868034975337796656295094902858969771811440894224355027779366597957338237853638272334919686385621811850780464277094400000000000000000000000000, 22311927486598136465966070212187151182564399087952213171022161345724023063584214692821047352118139068425569179220877461124773845924561575264739138192463311667200000000000000000000000000, 2543559733472187557120132004189335234812341496026552301496526393412538629248600474981599398141467853800514886431180030568224218435400019580180261753940817530060800000000000000000000000000, 292509369349301569068815180481773552003419272043053514672100535242441942363589054622883930786268803187059211939585703515345785120071002251720730101703194015956992000000000000000000000000000, 33931086844518982011982560935885732032396635556994207701963662088123265314176330336254535971207181169698868584991941607780111073928236261199604691797570505851011072000000000000000000000000000, 3969937160808720895401959629498630647790406360168322301129748464310422041758630649341780708631240196854767624444057168110272995649603642560353748940315749184568295424000000000000000000000000000, 468452584975429065657431236280838416439267950499862031533310318788629800927518416622330123618486343228862579684398745837012213486653229822121742374957258403779058860032000000000000000000000000000, 55745857612076058813234317117419771556272886109483581752463927935846946310374691578057284710599874844234646982443450754604453404911734348832487342619913750049708004343808000000000000000000000000000, 6689502913449127057588118054090372586752746333138029810295671352301633557244962989366874165271984981308157637893214090552534408589408121859898481114389650005964960521256960000000000000000000000000000, 809429852527344373968162284544935082997082306309701607045776233628497660426640521713391773997910182738287074185078904956856663439318382745047716214841147650721760223072092160000000000000000000000000000, 98750442008336013624115798714482080125644041369783596059584700502676714572050143649033796427745042294071023050579626404736512939596842694895821378210620013388054747214795243520000000000000000000000000000, 12146304367025329675766243241881295855454217088483382315328918161829235892362167668831156960612640202170735835221294047782591091570411651472186029519906261646730733907419814952960000000000000000000000000000, 1506141741511140879795014161993280686076322918971939407100785852066825250652908790935063463115967385069171243567440461925041295354731044782551067660468376444194611004520057054167040000000000000000000000000000, 188267717688892609974376770249160085759540364871492425887598231508353156331613598866882932889495923133646405445930057740630161919341380597818883457558547055524326375565007131770880000000000000000000000000000000, 23721732428800468856771473051394170805702085973808045661837377170052497697783313457227249544076486314839447086187187275319400401837013955325179315652376928996065123321190898603130880000000000000000000000000000000, 3012660018457659544809977077527059692324164918673621799053346900596667207618480809067860692097713761984609779945772783965563851033300772326297773087851869982500270661791244122597621760000000000000000000000000000000, 385620482362580421735677065923463640617493109590223590278828403276373402575165543560686168588507361534030051833058916347592172932262498857766114955245039357760034644709279247692495585280000000000000000000000000000000, 49745042224772874403902341504126809639656611137138843145968864022652168932196355119328515747917449637889876686464600208839390308261862352651828829226610077151044469167497022952331930501120000000000000000000000000000000, 6466855489220473672507304395536485253155359447828049608975952322944781961185526165512707047229268452925683969240398027149120740074042105844737747799459310029635780991774612983803150965145600000000000000000000000000000000, 847158069087882051098456875815279568163352087665474498775849754305766436915303927682164623187034167333264599970492141556534816949699515865660644961729169613882287309922474300878212776434073600000000000000000000000000000000, 111824865119600430744996307607616902997562475571842633838412167568361169672820118454045730260688510087990927196104962685462595837360336094267205134948250389032461924909766607715924086489297715200000000000000000000000000000000, 14872707060906857289084508911813048098675809251055070300508818286592035566485075754388082124671571841702793317081960037166525246368924700537538282948117301741317436012998958826217903503076596121600000000000000000000000000000000, 1992942746161518876737324194182948445222558439641379420268181650403332765909000151088003004705990626788174304488982644980314383013435909872030129915047718433336536425741860482713199069412263880294400000000000000000000000000000000, 269047270731805048359538766214698040105045389351586221736204522804449923397715020396880405635308734616403531106012657072342441706813847832724067538531441988500432417475151165166281874370655623839744000000000000000000000000000000000, 36590428819525486576897272205198933454286172951815726156123815101405189582089242773975735166401987907830880230417721361838572072126683305250473185240276110436058808776620558462614334914409164842205184000000000000000000000000000000000, 5012888748274991661034926292112253883237205694398754483388962668892510972746226260034675717797072343372830591567227826571884373881355612819314826377917827129740056802397016509378163883274055583382110208000000000000000000000000000000000, 691778647261948849222819828311491035886734385827028118707676848307166514238979223884785249055995983385450621636277440066920043595627074569065446040152660143904127838730788278294186615891819670506731208704000000000000000000000000000000000, 96157231969410890041971956135297253988256079629956908500367081914696145479218112119985149618783441690577636407442564169301886059792163365100096999581219760002673769583579570682891939608962934200435638009856000000000000000000000000000000000, 13462012475717524605876073858941615558355851148193967190051391468057460367090535696797920946629681836680869097041958983702264048370902871114013579941370766400374327741701139895604871545254810788060989321379840000000000000000000000000000000000, 1898143759076170969428526414110767793728175011895349373797246196996101911759765533248506853474785138972002542682916216702019230820297304827075914771733278062452780211579860725280286887880928321116599494314557440000000000000000000000000000000000, 269536413788816277658850750803729026709400851689139611079208959973446471469886705721287973193419489734024361060974102771686730776482217285444779897586125484868294790044340222989800738079091821598557128192667156480000000000000000000000000000000000, 38543707171800727705215657364933250819444321791546964384326881276202845420193798918144180166658987031965483631719296696351202501036957071818603525354815944336166154976340651887541505545310130488593669331551403376640000000000000000000000000000000000, 5550293832739304789551054660550388117999982337982762871343070903773209740507907044212761943998894132603029642967578724274573160149321818341878907651093495984407926316593053871805976798524658790357488383743402086236160000000000000000000000000000000000, 804792605747199194484902925779806277109997439007500616344745281047115412373646521410850481879839649227439298230298915019813108221651663659572441609408556917739149315905992811411866635786075524601835815642793302504243200000000000000000000000000000000000, 117499720439091082394795827163851716458059626095095089986332811032878850206552392125984170354456588787206137541623641592892713800361142894297576474973649309989915800122274950466132528824767026591868029083847822165619507200000000000000000000000000000000000, 17272458904546389112034986593086202319334765035978978227990923221833190980363201642519673042105118551719302218618675314155228928653088005461743741821126448568517622617974417718521481737240752909004600275325629858346067558400000000000000000000000000000000000, 2556323917872865588581178015776757943261545225324888777742656636831312265093753843092911610231557545654456728355563946494973881440657024808338073789526714388140608147460213822341179297111631430532680840748193219035217998643200000000000000000000000000000000000, 380892263763056972698595524350736933545970238573408427883655838887865527498969322620843829924502074302514052524979028027751108334657896696442372994639480443832950613971571859528835715269633083149369445271480789636247481797836800000000000000000000000000000000000, 57133839564458545904789328652610540031895535786011264182548375833179829124845398393126574488675311145377107878746854204162666250198684504466355949195922066574942592095735778929325357290444962472405416790722118445437122269675520000000000000000000000000000000000000, 8627209774233240431623188626544191544816225903687700891564804750810154197851655157362112747789971982951943289690774984828562603780001360174419748328584232052816331406456102618328128950857189333333217935399039885261005462721003520000000000000000000000000000000000000, 1311335885683452545606724671234717114812066337360530535517850322123143438073451583919041137664075741408695380032997797693941515774560206746511801745944803272028082373781327597985875600530292778666649126180654062559672830333592535040000000000000000000000000000000000000, 200634390509568239477828874698911718566246149616161171934231099284840946025238092339613294062603588435530393145048663047173051913507711632216305667129554900620296603188543122491838966881134795135997316305640071571629943041039657861120000000000000000000000000000000000000, 30897696138473508879585646703632404659201907040888820477871589289865505687886666220300447285640952619071680544337494109264649994680187591361311072737951454695525676891035640863743200899694758450943586711068571022031011228320107310612480000000000000000000000000000000000000, 4789142901463393876335775239063022722176295591337767174070096339929153381622433264146569329274347655956110484372311586936020749175429076661003216274382475477806479918110524333880196139452687559896255940215628508414806740389616633144934400000000000000000000000000000000000000, 747106292628289444708380937293831544659502112248691679154935029028947927533099589206864815366798234329153235562080607562019236871366935959116501738803666174537810867225241796085310597754619259343815926673638047312709851500780194770609766400000000000000000000000000000000000000, 117295687942641442819215807155131552511541831623044593627324799557544824622696635505477776012587322789677057983246655387237020188804608945581290772992175589402436306154362961985393763847475223716979100487761173428095446685622490578985733324800000000000000000000000000000000000000, 18532718694937347965436097530510785296823609396441045793117318330092082290386068409865488609988797000768975161352971551183449189831128213401843942132763743125584936372389347993692214687901085347282697877066265401639080576328353511479745865318400000000000000000000000000000000000000, 2946702272495038326504339507351214862194953894034126281105653614484641084171384877168612688988218723122267050655122476638168421183149385930893186799109435156968004883209906330997062135376272570217948962453536198860613811636208208325279592585625600000000000000000000000000000000000000, 471472363599206132240694321176194377951192623045460204976904578317542573467421580346978030238114995699562728104819596262106947389303901748942909887857509625114880781313585012959529941660203611234871833992565791817698209861793313332044734813700096000000000000000000000000000000000000000, 75907050539472187290751785709367294850142012310319093001281637109124354328254874435863462868336514307629599224875954998199218529677928181579808491945059049643495805791487187086484320607292781408814365272803092482649411787748723446459202305005715456000000000000000000000000000000000000000, 12296942187394494341101789284917501765723005994271693066207625211678145401177289658609880984670515317835995074429904709708273401807824365415928975695099566042246320538220924308010459938381430588227927174194100982189204709615293198326390773410925903872000000000000000000000000000000000000000, 2004401576545302577599591653441552787812849977066285969791842909503537700391898214353410600501293996807267197132074467682448564494675371562796423038301229264886150247730010662205704969956173185881152129393638460096840367667292791327201696065980922331136000000000000000000000000000000000000000, 328721858553429622726333031164414657201307396238870899045862237158580182864271307153959338482212215476391820329660212699921564577126760936298613378281401599441328640627721748601735615072812402484508949220556707455881820297436017777661078154820871262306304000000000000000000000000000000000000000, 54239106661315887749844950142128418438215720379413698342567269131165730172604765680403290849565015553604650354393935095487058155225915554489271207416431263907819225703574088519286376487014046409943976621391856730220500349076942933314077895545443758280540160000000000000000000000000000000000000000, 9003691705778437366474261723593317460743809582982673924866166675773511208652391102946946281027792581898371958829393225850851653767501982045219020431127589808697991466793298694201538496844331704050700119151048217216603057946772526930136930660543663874569666560000000000000000000000000000000000000000, 1503616514864999040201201707840084015944216200358106545452649834854176371844949314192140028931641361177028117124508668717092226179172831001551576411998307498052564574954480881931656928973003394576466919898225052275172710677111011997332867420310791867053134315520000000000000000000000000000000000000000, 252607574497319838753801886917134114678628321660161899636045172255501630469951484784279524860515748677740723676917456344471493998101035608260664837215715659672830848592352788164518364067464570288846442542901808782229015393754650015551921726612213033664926565007360000000000000000000000000000000000000000, 42690680090047052749392518888995665380688186360567361038491634111179775549421800928543239701427161526538182301399050122215682485679075017796052357489455946484708413412107621199803603527401512378815048789750405684196703601544535852628274771797464002689372589486243840000000000000000000000000000000000000000, 7257415615307998967396728211129263114716991681296451376543577798900561843401706157852350749242617459511490991237838520776666022565442753025328900773207510902400430280058295603966612599658257104398558294257568966313439612262571094946806711205568880457193340212661452800000000000000000000000000000000000000000];
  P.factorial=P.fact=function (){
    var x=this.clone();
    var f=ExpantaNum.factorials;
    if (x.lt(ExpantaNum.ZERO)||!x.isint()) return x.add(1).gamma();
    if (x.lte(170)) return new ExpantaNum(f[+x]);
    var errorFixer=1;
    var e=+x;
    if (e<500) e+=163879/209018880*Math.pow(e,5);
    if (e<1000) e+=-571/2488320*Math.pow(e,4);
    if (e<50000) e+=-139/51840*Math.pow(e,3);
    if (e<1e7) e+=1/288*Math.pow(e,2);
    if (e<1e20) e+=1/12*e;
    return x.div(ExpantaNum.E).pow(x).mul(x.mul(ExpantaNum.PI).mul(2).sqrt()).times(errorFixer);
  };
  Q.factorial=Q.fact=function (x){
    return new ExpantaNum(x).fact();
  };
  P.toPower=P.pow=function (other){
    other=new ExpantaNum(other);
    if (ExpantaNum.debug>=ExpantaNum.NORMAL) console.log(this+"^"+other);
    if (other.eq(ExpantaNum.ZERO)) return ExpantaNum.ONE.clone();
    if (other.eq(ExpantaNum.ONE)) return this.clone();
    if (other.lt(ExpantaNum.ZERO)) return this.pow(other.neg()).rec();
    if (this.lt(ExpantaNum.ZERO)&&other.isint()){
      if (other.mod(2).lt(ExpantaNum.ONE)) return this.abs().pow(other);
      return this.abs().pow(other).neg();
    }
    if (this.lt(ExpantaNum.ZERO)) return ExpantaNum.NaN.clone();
    if (this.eq(ExpantaNum.ONE)) return ExpantaNum.ONE.clone();
    if (this.eq(ExpantaNum.ZERO)) return ExpantaNum.ZERO.clone();
    if (this.max(other).gt(ExpantaNum.TETRATED_MAX_SAFE_INTEGER)) return this.max(other);
    if (this.eq(10)){
      if (other.gt(ExpantaNum.ZERO)){
        other.operator(1,(other.operator(1)+1)||1);
        other.standardize();
        return other;
      }else{
        return new ExpantaNum(Math.pow(10,other.toNumber()));
      }
    }
    if (other.lt(ExpantaNum.ONE)) return this.root(other.rec());
    var n=Math.pow(this.toNumber(),other.toNumber());
    if (n<=MAX_SAFE_INTEGER) return new ExpantaNum(n);
    return ExpantaNum.pow(10,this.log10().mul(other));
  };
  Q.toPower=Q.pow=function (x,y){
    return new ExpantaNum(x).pow(y);
  };
  P.exponential=P.exp=function (){
    return ExpantaNum.pow(Math.E,this);
  };
  Q.exponential=Q.exp=function (x){
    return ExpantaNum.pow(Math.E,x);
  };
  P.squareRoot=P.sqrt=function (){
    return this.root(2);
  };
  Q.squareRoot=Q.sqrt=function (x){
    return new ExpantaNum(x).root(2);
  };
  P.cubeRoot=P.cbrt=function (){
    return this.root(3);
  };
  Q.cubeRoot=Q.cbrt=function (x){
    return new ExpantaNum(x).root(3);
  };
  P.root=function (other){
    other=new ExpantaNum(other);
    if (ExpantaNum.debug>=ExpantaNum.NORMAL) console.log(this+"root"+other);
    if (other.eq(ExpantaNum.ONE)) return this.clone();
    if (other.lt(ExpantaNum.ZERO)) return this.root(other.neg()).rec();
    if (other.lt(ExpantaNum.ONE)) return this.pow(other.rec());
    if (this.lt(ExpantaNum.ZERO)&&other.isint()&&other.mod(2).eq(ExpantaNum.ONE)) return this.neg().root(other).neg();
    if (this.lt(ExpantaNum.ZERO)) return ExpantaNum.NaN.clone();
    if (this.eq(ExpantaNum.ONE)) return ExpantaNum.ONE.clone();
    if (this.eq(ExpantaNum.ZERO)) return ExpantaNum.ZERO.clone();
    if (this.max(other).gt(ExpantaNum.TETRATED_MAX_SAFE_INTEGER)) return this.gt(other)?this.clone():ExpantaNum.ZERO.clone();
    return ExpantaNum.pow(10,this.log10().div(other));
  };
  Q.root=function (x,y){
    return new ExpantaNum(x).root(y);
  };
  P.generalLogarithm=P.log10=function (){
    var x=this.clone();
    if (ExpantaNum.debug>=ExpantaNum.NORMAL) console.log("log"+this);
    if (x.lt(ExpantaNum.ZERO)) return ExpantaNum.NaN.clone();
    if (x.eq(ExpantaNum.ZERO)) return ExpantaNum.NEGATIVE_INFINITY.clone();
    if (x.lte(ExpantaNum.MAX_SAFE_INTEGER)) return new ExpantaNum(Math.log10(x.toNumber()));
    if (!x.isFinite()) return x;
    if (x.gt(ExpantaNum.TETRATED_MAX_SAFE_INTEGER)) return x;
    x.operator(1,x.operator(1)-1);
    return x.standardize();
  };
  Q.generalLogarithm=Q.log10=function (x){
    return new ExpantaNum(x).log10();
  };
  P.logarithm=P.logBase=function (base){
    if (base===undefined) base=Math.E;
    return this.log10().div(ExpantaNum.log10(base));
  };
  Q.logarithm=Q.logBase=function (x,base){
    return new ExpantaNum(x).logBase(base);
  };
  P.naturalLogarithm=P.log=P.ln=function (){
    return this.logBase(Math.E);
  };
  Q.naturalLogarithm=Q.log=Q.ln=function (x){
    return new ExpantaNum(x).ln();
  };
  //All of these are from Patashu's break_eternity.js
  var OMEGA=0.56714329040978387299997;  //W(1,0)
  //from https://math.stackexchange.com/a/465183
  //The evaluation can become inaccurate very close to the branch point
  var f_lambertw=function (z,tol){
    if (tol===undefined) tol=1e-10;
    var w;
    var wn;
    if (!Number.isFinite(z)) return z;
    if (z===0) return z;
    if (z===1) return OMEGA;
    if (z<10) w=0;
    else w=Math.log(z)-Math.log(Math.log(z));
    for (var i=0;i<100;++i){
      wn=(z*Math.exp(-w)+w*w)/(w+1);
      if (Math.abs(wn-w)<tol*Math.abs(wn)) return wn;
      w=wn;
    }
    throw Error("Iteration failed to converge: "+z);
    //return Number.NaN;
  };
  //from https://github.com/scipy/scipy/blob/8dba340293fe20e62e173bdf2c10ae208286692f/scipy/special/lambertw.pxd
  //The evaluation can become inaccurate very close to the branch point
  //at ``-1/e``. In some corner cases, `lambertw` might currently
  //fail to converge, or can end up on the wrong branch.
  var d_lambertw=function (z,tol){
    if (tol===undefined) tol=1e-10;
    z=new ExpantaNum(z);
    var w;
    var ew, wewz, wn;
    if (!z.isFinite()) return z;
    if (z===0) return z;
    if (z===1){
      //Split out this case because the asymptotic series blows up
      return OMEGA;
    }
    //Get an initial guess for Halley's method
    w=ExpantaNum.ln(z);
    //Halley's method; see 5.9 in [1]
    for (var i=0;i<100;++i){
      ew=ExpantaNum.exp(-w);
      wewz=w.sub(z.mul(ew));
      wn=w.sub(wewz.div(w.add(ExpantaNum.ONE).sub((w.add(2)).mul(wewz).div((ExpantaNum.mul(2,w).add(2))))));
      if (ExpantaNum.abs(wn.sub(w)).lt(ExpantaNum.abs(wn).mul(tol))) return wn;
      w = wn;
    }
    throw Error("Iteration failed to converge: "+z);
    //return Decimal.dNaN;
  };
  //The Lambert W function, also called the omega function or product logarithm, is the solution W(x) === x*e^x.
  //https://en.wikipedia.org/wiki/Lambert_W_function
  //Some special values, for testing: https://en.wikipedia.org/wiki/Lambert_W_function#Special_values
  P.lambertw=function (){
    var x=this.clone();
    if (x.isNaN()) return x;
    if (x.lt(-0.3678794411710499)) throw Error("lambertw is unimplemented for results less than -1, sorry!");
    if (x.gt(ExpantaNum.TETRATED_MAX_SAFE_INTEGER)) return x;
    if (x.gt(ExpantaNum.EE_MAX_SAFE_INTEGER)){
      x.operator(1,x.operator(1)-1);
      return x;
    }
    if (x.gt(ExpantaNum.MAX_SAFE_INTEGER)) return d_lambertw(x);
    else return new ExpantaNum(f_lambertw(x.sign*x.operator(0)));
  };
  Q.lambertw=function (x){
    return new ExpantaNum(x).lambertw();
  };
  //end break_eternity.js excerpt
  //Uses linear approximations for real height
  P.tetrate=P.tetr=function (other,payload){
    if (payload===undefined) payload=ExpantaNum.ONE;
    var t=this.clone();
    other=new ExpantaNum(other);
    payload=new ExpantaNum(payload);
    if (payload.neq(ExpantaNum.ONE)) other=other.add(payload.slog(t));
    if (ExpantaNum.debug>=ExpantaNum.NORMAL) console.log(t+"^^"+other);
    var negln;
    if (t.isNaN()||other.isNaN()||payload.isNaN()) return ExpantaNum.NaN.clone()
    if (other.isInfinite()&&other.sign>0){
      if (t.gte(Math.exp(1/Math.E))) return ExpantaNum.POSITIVE_INFINITY.clone();
      //Formula for infinite height power tower.
      negln = t.ln().neg();
      return negln.lambertw().div(negln);
    }
    if (other.lte(-2)) return ExpantaNum.NaN.clone();
    if (t.eq(ExpantaNum.ZERO)){
      if (other.eq(ExpantaNum.ZERO)) return ExpantaNum.NaN.clone();
      if (other.mod(2).eq(ExpantaNum.ZERO)) return ExpantaNum.ZERO.clone();
      return ExpantaNum.ONE.clone();
    }
    if (t.eq(ExpantaNum.ONE)){
      if (other.eq(ExpantaNum.ONE.neg())) return ExpantaNum.NaN.clone();
      return ExpantaNum.ONE.clone();
    }
    if (other.eq(ExpantaNum.ONE.neg())) return ExpantaNum.ZERO.clone();
    if (other.eq(ExpantaNum.ZERO)) return ExpantaNum.ONE.clone();
    if (other.eq(ExpantaNum.ONE)) return t;
    if (other.eq(2)) return t.pow(t);
    if (t.eq(2)){
      if (other.eq(3)) return new ExpantaNum(16);
      if (other.eq(4)) return new ExpantaNum(65536);
    }
    var m=t.max(other);
    if (m.gt("10^^^"+MAX_SAFE_INTEGER)) return m;
    if (m.gt(ExpantaNum.TETRATED_MAX_SAFE_INTEGER)||other.gt(ExpantaNum.MAX_SAFE_INTEGER)){
      if (this.lt(Math.exp(1/Math.E))){
        negln = t.ln().neg();
        return negln.lambertw().div(negln);
      }
      var j=t.slog(10).add(other);
      j.operator(2,(other.operator(2)||0)+1);
      j.standardize();
      return j;
    }
    var y=other.toNumber();
    var f=Math.floor(y);
    var r=t.pow(y-f);
    var l=ExpantaNum.NaN;
    for (var i=0,m=new ExpantaNum(ExpantaNum.E_MAX_SAFE_INTEGER);f!==0&&r.lt(m)&&i<100;++i){
      if (f>0){
        r=t.pow(r);
        if (l.eq(r)){
          f=0;
          break;
        }
        l=r;
        --f;
      }else{
        r=r.logBase(t);
        if (l.eq(r)){
          f=0;
          break;
        }
        l=r;
        ++f;
      }
    }
    if (i==100||this.lt(Math.exp(1/Math.E))) f=0;
    r.operator(1,(r.operator(1)+f)||f);
    r.standardize();
    return r;
  };
  Q.tetrate=Q.tetr=function (x,y,payload){
    return new ExpantaNum(x).tetr(y,payload);
  };
  //Implementation of functions from break_eternity.js
  P.iteratedexp=function (other,payload){
    return this.tetr(other,payload);
  };
  Q.iteratedexp=function (x,y,payload){
    return new ExpantaNum(x).iteratedexp(other,payload);
  };
  //This implementation is highly inaccurate and slow, and probably be given custom code
  P.iteratedlog=function (base,other){
    if (base===undefined) base=10;
    if (other===undefined) other=ExpantaNum.ONE.clone();
    var t=this.clone();
    base=new ExpantaNum(base);
    other=new ExpantaNum(other);
    return base.tetr(t.slog(base).sub(other));
  };
  Q.iteratedlog=function (x,y,z){
    return new ExpantaNum(x).iteratedlog(y,z);
  };
  P.layeradd=function (other,base){
    if (base===undefined) base=10;
    if (other===undefined) other=ExpantaNum.ONE.clone();
    var t=this.clone();
    base=new ExpantaNum(base);
    other=new ExpantaNum(other);
    return base.tetr(t.slog(base).add(other));
  };
  Q.layeradd=function (x,y,z){
    return new ExpantaNum(x).layeradd(y,z);
  };
  P.layeradd10=function (other){
    return this.layeradd(other);
  };
  Q.layeradd10=function (x,y){
    return new ExpantaNum(x).layeradd10(y);
  };
  //End implementation from break_eternity.js
  //All of these are from Patashu's break_eternity.js
  //The super square-root function - what number, tetrated to height 2, equals this?
  //Other sroots are possible to calculate probably through guess and check methods, this one is easy though.
  //https://en.wikipedia.org/wiki/Tetration#Super-root
  P.ssqrt=P.ssrt=function (){
    var x=this.clone();
    if (x.lt(Math.exp(-1/Math.E))) return ExpantaNum.NaN.clone();
    if (!x.isFinite()) return x;
    if (x.gt(ExpantaNum.TETRATED_MAX_SAFE_INTEGER)) return x;
    if (x.gt(ExpantaNum.EE_MAX_SAFE_INTEGER)){
      x.operator(1,x.operator(1)-1);
      return x;
    }
    var l=x.ln();
    return l.div(l.lambertw());
  };
  Q.ssqrt=Q.ssrt=function (x){
    return new ExpantaNum(x).ssqrt();
  };
  //Super-logarithm, one of tetration's inverses, tells you what size power tower you'd have to tetrate base to to get number. By definition, will never be higher than 1.8e308 in break_eternity.js, since a power tower 1.8e308 numbers tall is the largest representable number.
  //Uses linear approximation
  //https://en.wikipedia.org/wiki/Super-logarithm
  P.slog=function (base){
    if (base===undefined) base=10;
    var x=new ExpantaNum(this);
    base=new ExpantaNum(base);
    if (x.isNaN()||base.isNaN()||x.isInfinite()&&base.isInfinite()) return ExpantaNum.NaN.clone();
    if (x.isInfinite()) return x;
    if (base.isInfinite()) return ExpantaNum.ZERO.clone();
    if (x.lt(ExpantaNum.ZERO)) return ExpantaNum.ONE.neg();
    if (x.eq(ExpantaNum.ONE)) return ExpantaNum.ZERO.clone();
    if (x.eq(base)) return ExpantaNum.ONE.clone();
    if (base.lt(Math.exp(1/Math.E))){
      var a=ExpantaNum.tetr(base,Infinity);
      if (x.eq(a)) return ExpantaNum.POSITIVE_INFINITY.clone();
      if (x.gt(a)) return ExpantaNum.NaN.clone();
    }
    if (x.max(base).gt("10^^^"+MAX_SAFE_INTEGER)){
      if (x.gt(base)) return x;
      return ExpantaNum.ZERO.clone();
    }
    if (x.max(base).gt(ExpantaNum.TETRATED_MAX_SAFE_INTEGER)){
      if (x.gt(base)){
        x.operator(2,x.operator(2)-1);
        x.standardize();
        return x.sub(x.operator(1));
      }
      return ExpantaNum.ZERO.clone();
    }
    var r=0;
    var t=(x.operator(1)||0)-(base.operator(1)||0);
    if (t>3){
      var l=t-3;
      r+=l;
      x.operator(1,x.operator(1)-l);
    }
    for (var i=0;i<100;++i){
      if (x.lt(ExpantaNum.ZERO)){
        x=ExpantaNum.pow(base,x);
        --r;
      }else if (x.lte(1)){
        return new ExpantaNum(r+x.toNumber()-1);
      }else{
        ++r;
        x=ExpantaNum.logBase(x,base);
      }
    }
    if (x.gt(10))
    return new ExpantaNum(r);
  };
  Q.slog=function (x,y){
    return new ExpantaNum(x).slog(y);
  };
  //end break_eternity.js excerpt
  P.pentate=P.pent=function (other){
    return this.arrow(3)(other);
  };
  Q.pentate=Q.pent=function (x,y){
    return ExpantaNum.arrow(x,3,y);
  };
  //Uses linear approximations for real height
  P.arrow=function (arrows){
    var t=this.clone();
    arrows=new ExpantaNum(arrows);
    if (!arrows.isint()||arrows.lt(ExpantaNum.ZERO)) return function(other){return ExpantaNum.NaN.clone();};
    if (arrows.eq(ExpantaNum.ZERO)) return function(other){return t.mul(other);};
    if (arrows.eq(ExpantaNum.ONE)) return function(other){return t.pow(other);};
    if (arrows.eq(2)) return function(other){return t.tetr(other);};
    return function (other){
      var depth;
      if (arguments.length==2) depth=arguments[1]; //must hide
      else depth=0;
      other=new ExpantaNum(other);
      var r;
      if (ExpantaNum.debug>=ExpantaNum.NORMAL) console.log(t+"{"+arrows+"}"+other);
    if (t.isNaN()||other.isNaN()) return ExpantaNum.NaN.clone()
      if (other.lt(ExpantaNum.ZERO)) return ExpantaNum.NaN.clone();
      if (t.eq(ExpantaNum.ZERO)){
        if (other.eq(ExpantaNum.ONE)) return ExpantaNum.ZERO.clone();
        return ExpantaNum.NaN.clone();
      }
      if (t.eq(ExpantaNum.ONE)) return ExpantaNum.ONE.clone();
      if (other.eq(ExpantaNum.ZERO)) return ExpantaNum.ONE.clone();
      if (other.eq(ExpantaNum.ONE)) return t.clone();
      if (arrows.gt(ExpantaNum.MAX_SAFE_INTEGER)){
        r=arrows.clone();
        r.layer++;
        return r;
      }
      if (other.eq(2)) return t.arrow(arrows-1)(t,depth+1);
      if (t.max(other).gt("10{"+arrows.add(ExpantaNum.ONE)+"}"+MAX_SAFE_INTEGER)) return t.max(other);
      if (t.gt("10{"+arrows+"}"+MAX_SAFE_INTEGER)||other.gt(ExpantaNum.MAX_SAFE_INTEGER)){
        if (t.gt("10{"+arrows+"}"+MAX_SAFE_INTEGER)){
          r=t.clone();
          r.operator(arrows,r.operator(arrows)-1);
          r.standardize();
        }else if (t.gt("10{"+arrows.sub(ExpantaNum.ONE)+"}"+MAX_SAFE_INTEGER)){
          r=new ExpantaNum(t.operator(arrows-1));
        }else{
          r=ExpantaNum.ZERO;
        }
        var j=r.add(other);
        j.operator(arrows,(other.operator(arrows)||0)+1);
        j.standardize();
        return j;
      }
      if (depth>=ExpantaNum.maxOps+10){
        return new ExpantaNum([[0,10],[Number(arrows),1]]);
      }
      var y=other.toNumber();
      var f=Math.floor(y);
      r=t.arrow(arrows.sub(1))(y-f,depth+1);
      for (var i=0,m=new ExpantaNum("10{"+arrows.sub(ExpantaNum.ONE)+"}"+MAX_SAFE_INTEGER);f!==0&&r.lt(m)&&i<100;++i){
        if (f>0){
          r=t.arrow(arrows.sub(ExpantaNum.ONE))(r,depth+1);
          --f;
        }
      }
      if (i==100) f=0;
      r.operator(Number(arrows.sub(ExpantaNum.ONE)),(r.operator(Number(arrows.sub(ExpantaNum.ONE)))+f)||f);
      r.standardize();
      return r;
    };
  };
  P.chain=function (other,arrows){
    return this.arrow(arrows)(other);
  };
  Q.arrow=function (x,z,y){
    return new ExpantaNum(x).arrow(z)(y);
  };
  Q.chain=function (x,y,z){
    return new ExpantaNum(x).arrow(z)(y);
  };
  Q.hyper=function (z){
    z=new ExpantaNum(z);
    if (z.eq(ExpantaNum.ZERO)) return function(x,y){return new ExpantaNum(y).eq(ExpantaNum.ZERO)?new ExpantaNum(x):new ExpantaNum(x).add(ExpantaNum.ONE);};
    if (z.eq(ExpantaNum.ONE)) return function(x,y){return ExpantaNum.add(x,y);};
    return function(x,y){return new ExpantaNum(x).arrow(z.sub(2))(y);};
  };
  P.expansion=function (other){
    var t=this.clone();
    other=new ExpantaNum(other);
    var r;
    if (ExpantaNum.debug>=ExpantaNum.NORMAL) console.log("{"+t+","+other+",1,2}");
    if (other.lte(ExpantaNum.ZERO)||!other.isint()) return ExpantaNum.NaN.clone();
    if (other.eq(ExpantaNum.ONE)) return t.clone();
    if (!t.isint()) return ExpantaNum.NaN.clone();
    if (t.eq(2)) return ExpantaNum(4);
    if (other.gt(ExpantaNum.MAX_SAFE_INTEGER)) return ExpantaNum.POSITIVE_INFINITY.clone();
    var f=other.toNumber()-1;
    r=t;
    for (var i=0;f!==0&&r.lt(ExpantaNum.MAX_SAFE_INTEGER)&&i<100;++i){
      if (f>0){
        r=t.arrow(r)(t);
        --f;
      }
    }
    if (i==100) f=0;
    r.layer+=f;
    r.standardize();
    return r;
  };
  Q.expansion=function (x,y){
    return new ExpantaNum(x).expansion(y);
  };
  // All of these are from Patashu's break_eternity.js
  Q.affordGeometricSeries = function (resourcesAvailable, priceStart, priceRatio, currentOwned) {
    /*
      If you have resourcesAvailable, the price of something starts at
      priceStart, and on each purchase it gets multiplied by priceRatio,
      and you have already bought currentOwned, how many of the object
      can you buy.
    */
    resourcesAvailable=new ExpantaNum(resourcesAvailable);
    priceStart=new ExpantaNum(priceStart);
    priceRatio=new ExpantaNum(priceRatio);
    var actualStart = priceStart.mul(priceRatio.pow(currentOwned));
    return ExpantaNum.floor(resourcesAvailable.div(actualStart).mul(priceRatio.sub(ExpantaNum.ONE)).add(ExpantaNum.ONE).log10().div(priceRatio.log10()));
  };
  Q.affordArithmeticSeries = function (resourcesAvailable, priceStart, priceAdd, currentOwned) {
    /*
      If you have resourcesAvailable, the price of something starts at
      priceStart, and on each purchase it gets increased by priceAdd,
      and you have already bought currentOwned, how many of the object
      can you buy.
    */
    resourcesAvailable=new ExpantaNum(resourcesAvailable);
    priceStart=new ExpantaNum(priceStart);
    priceAdd=new ExpantaNum(priceAdd);
    currentOwned=new ExpantaNum(currentOwned);
    var actualStart = priceStart.add(currentOwned.mul(priceAdd));
    var b = actualStart.sub(priceAdd.div(2));
    var b2 = b.pow(2);
    return b.neg().add(b2.add(priceAdd.mul(resourcesAvailable).mul(2)).sqrt()).div(priceAdd).floor();
  };
  Q.sumGeometricSeries = function (numItems, priceStart, priceRatio, currentOwned) {
    /*
      If you want to buy numItems of something, the price of something starts at
      priceStart, and on each purchase it gets multiplied by priceRatio,
      and you have already bought currentOwned, what will be the price of numItems
      of something.
    */
    priceStart=new ExpantaNum(priceStart);
    priceRatio=new ExpantaNum(priceRatio);
    return priceStart.mul(priceRatio.pow(currentOwned)).mul(ExpantaNum.sub(ExpantaNum.ONE, priceRatio.pow(numItems))).div(ExpantaNum.sub(ExpantaNum.ONE, priceRatio));
  };
  Q.sumArithmeticSeries = function (numItems, priceStart, priceAdd, currentOwned) {
    /*
      If you want to buy numItems of something, the price of something starts at
      priceStart, and on each purchase it gets increased by priceAdd,
      and you have already bought currentOwned, what will be the price of numItems
      of something.
    */
    numItems=new ExpantaNum(numItems);
    priceStart=new ExpantaNum(priceStart);
    currentOwned=new ExpantaNum(currentOwned);
    var actualStart = priceStart.add(currentOwned.mul(priceAdd));

    return numItems.div(2).mul(actualStart.mul(2).plus(numItems.sub(ExpantaNum.ONE).mul(priceAdd)));
  };
  // Binomial Coefficients n choose k
  Q.choose = function (n, k) {
    /*
      If you have n items and you take k out,
      how many ways could you do this?
    */
    return new ExpantaNum(n).factorial().div(new ExpantaNum(k).factorial().mul(new ExpantaNum(n).sub(new ExpantaNum(k)).factorial()));
  };
  P.choose = function (other) {
    return ExpantaNum.choose(this, other);
  };
  //end break_eternity.js excerpt
  P.standardize=function (){
    var b;
    var x=this;
    if (ExpantaNum.debug>=ExpantaNum.ALL) console.log(x.toString());
    if (!x.array||!x.array.length) x.array=[[0,0]];
    if (x.sign!=1&&x.sign!=-1){
      if (typeof x.sign!="number") x.sign=Number(x.sign);
      x.sign=x.sign<0?-1:1;
    }
    if (x.layer>MAX_SAFE_INTEGER){
      x.array=[[0,Infinity]];
      x.layer=0;
      return x;
    }
    for (var i=0;i<x.array.length;++i){
      var e=x.array[i];
      if (e[0]===null||e[0]===undefined){
        e[0]=0;
      }
      if (e[0]!==0&&(e[1]===0||e[1]===null||e[1]===undefined)){
        x.array.splice(i,1);
        --i;
        continue;
      }
      if (isNaN(e[0])||isNaN(e[1])){
        x.array=[[0,NaN]];
        return x;
      }
      if (!isFinite(e[0])||!isFinite(e[1])){
        x.array=[[0,Infinity]];
        return x;
      }
    }
    do{
      if (ExpantaNum.debug>=ExpantaNum.ALL) console.log(x.toString());
      b=false;
      x.array.sort(function (a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:0;});
      if (x.array.length>ExpantaNum.maxOps) x.array.splice(0,x.array.length-ExpantaNum.maxOps);
      if (!x.array.length) x.array=[[0,0]];
      if (x.array[x.array.length-1][0]>MAX_SAFE_INTEGER){
        x.layer++;
        x.array=[[0,x.array[x.array.length-1][0]]];
        b=true;
        continue;
      }else if (x.layer&&x.array.length==1&&x.array[0][0]===0){
        x.layer--;
        x.array=[[0,10],[x.array[0][1],1]];
        b=true;
        continue;
      }
      if (x.array.length<ExpantaNum.maxOps&&x.array[0][0]!==0) x.array.unshift([0,10]);
      for (i=0;i<x.array.length-1;++i){
        if (x.array[i][0]==x.array[i+1][0]){
          x.array[i][1]+=x.array[i+1][1];
          x.array.splice(i+1,1);
          --i;
          b=true;
        }
      }
      if (x.array[0][0]===0&&x.array[0][1]>MAX_SAFE_INTEGER){
        if (x.array.length>=2&&x.array[1][0]==1){
          x.array[1][1]++;
        }else{
          x.array.splice(1,0,[1,1]);
        }
        x.array[0][1]=Math.log10(x.array[0][1]);
        b=true;
      }
      while (x.array.length>=2&&x.array[0][0]===0&&x.array[0][1]<MAX_E&&x.array[1][0]==1&&x.array[1][1]){
        x.array[0][1]=Math.pow(10,x.array[0][1]);
        if (x.array[1][1]>1){
          x.array[1][1]--;
        }else{
          x.array.splice(1,1);
        }
        b=true;
      }
      while (x.array.length>=2&&x.array[0][0]===0&&x.array[0][1]==1&&x.array[1][1]){
        if (x.array[1][1]>1){
          x.array[1][1]--;
        }else{
          x.array.splice(1,1);
        }
        x.array[0][1]=10;
      }
      if (x.array.length>=2&&x.array[0][0]===0&&x.array[1][0]!=1){
        if (x.array[0][1]) x.array.splice(1,0,[x.array[1][0]-1,x.array[0][1]]);
        x.array[0][1]=1;
        if (x.array[2][1]>1){
          x.array[2][1]--;
        }else{
          x.array.splice(2,1);
        }
        b=true;
      }
      for (i=1;i<x.array.length;++i){
        if (x.array[i][1]>MAX_SAFE_INTEGER){
          if (i!=x.array.length-1&&x.array[i+1][0]==x.array[i][0]+1){
            x.array[i+1][1]++;
          }else{
            x.array.splice(i+1,0,[x.array[i][0]+1,1]);
          }
          if (x.array[0][0]===0){
            x.array[0][1]=x.array[i][1]+1;
          }else{
            x.splice(0,0,[0,x.array[i][1]+1]);
          }
          x.splice(1,i);
          b=true;
        }
      }
    }while(b);
    if (!x.array.length) x.array=[[0,0]];
    return x;
  };
  P.toNumber=function (){
    //console.log(this.array);
    if (this.sign==-1) return -1*this.abs();
    if (this.array.length>=2&&(this.array[1][0]>=2||this.array[1][1]>=2||this.array[1][1]==1&&this.array[0][1]>Math.log10(Number.MAX_VALUE))) return Infinity;
    if (this.array.length>=2&&this.array[1][1]==1) return Math.pow(10,this.array[0][1]);
    return this.array[0][1];
  };
  P.toString=function (){
    if (this.sign==-1) return "-"+this.abs();
    if (isNaN(this.array[0][1])) return "NaN";
    if (!isFinite(this.array[0][1])) return "Infinity";
    var s="";
    if (!this.layer) s+="";
    else if (this.layer<3) s+="J".repeat(this.layer);
    else s+="J^"+this.layer+" ";
    if (this.array.length>=3||this.array.length==2&&this.array[1][0]>=2){
      for (var i=this.array.length-1;i>=2;--i){
        var e=this.array[i];
        var q=e[0]>=5?"{"+e[0]+"}":"^".repeat(e[0]);
        if (e[1]>1) s+="(10"+q+")^"+e[1]+" ";
        else if (e[1]==1) s+="10"+q;
      }
    }
    var op0=this.operator(0);
    var op1=this.operator(1);
    if (!op1) s+=String(op0);
    else if (op1<3) s+="e".repeat(op1-1)+Math.pow(10,op0-Math.floor(op0))+"e"+Math.floor(op0);
    else if (op1<8) s+="e".repeat(op1)+op0;
    else s+="(10^)^"+op1+" "+op0;
    return s;
  };
  //from break_eternity.js
  var decimalPlaces=function decimalPlaces(value,places){
    var len=places+1;
    var numDigits=Math.ceil(Math.log10(Math.abs(value)));
    var rounded=Math.round(value*Math.pow(10,len-numDigits))*Math.pow(10,numDigits-len);
    return parseFloat(rounded.toFixed(Math.max(len-numDigits,0)));
  };
  P.toStringWithDecimalPlaces=function (places,applyToOpNums){
    if (this.sign==-1) return "-"+this.abs();
    if (isNaN(this.array[0][1])) return "NaN";
    if (!isFinite(this.array[0][1])) return "Infinity";
    var b=0;
    var s="";
    var m=Math.pow(10,places);
    if (!this.layer) s+="";
    else if (this.layer<3) s+="J".repeat(this.layer);
    else s+="J^"+this.layer+" ";
    if (this.array.length>=3||this.array.length==2&&this.array[1][0]>=2){
      for (var i=this.array.length-1;!b&&i>=2;--i){
        var e=this.array[i];
        var w=e[0];
        var x=e[1];
        if (applyToOpNums&&x>=m){
          ++w;
          b=x;
          x=1;
        }else if (applyToOpNums&&this.array[i-1][0]==w-1&&this.array[i-1][1]>=m){
          ++x;
          b=this.array[i-1][1];
        }
        var q=w>=5?"{"+w+"}":"^".repeat(w);
        if (x>1) s+="(10"+q+")^"+x+" ";
        else if (x==1) s+="10"+q;
      }
    }
    var k=this.operator(0);
    var l=this.operator(1);
    if (k>m){
      k=Math.log10(k);
      ++l;
    }
    if (b) s+=decimalPlaces(b,places);
    else if (!l) s+=String(decimalPlaces(k,places));
    else if (l<3) s+="e".repeat(l-1)+decimalPlaces(Math.pow(10,k-Math.floor(k)),places)+"e"+decimalPlaces(Math.floor(k),places);
    else if (l<8) s+="e".repeat(l)+decimalPlaces(k,places);
    else if (applyToOpNums) s+="(10^)^"+decimalPlaces(l,places)+" "+decimalPlaces(k,places);
    else s+="(10^)^"+l+" "+decimalPlaces(k,places);
    return s;
  };
  //these are from break_eternity.js as well
  P.toExponential=function (places,applyToOpNums){
    if (this.array.length==1) return (this.sign*this.array[0][1]).toExponential(places);
    return this.toStringWithDecimalPlaces(places,applyToOpNums);
  };
  P.toFixed=function (places,applyToOpNums){
    if (this.array.length==1) return (this.sign*this.array[0][1]).toFixed(places);
    return this.toStringWithDecimalPlaces(places,applyToOpNums);
  };
  P.toPrecision=function (places,applyToOpNums){
    if (this.array[0][1]===0) return (this.sign*this.array[0][1]).toFixed(places-1,applyToOpNums);
    if (this.array.length==1&&this.array[0][1]<1e-6) return this.toExponential(places-1,applyToOpNums);
    if (this.array.length==1&&places>Math.log10(this.array[0][1])) return this.toFixed(places-Math.floor(Math.log10(this.array[0][1]))-1,applyToOpNums);
    return this.toExponential(places-1,applyToOpNums);
  };
  P.valueOf=function (){
    return this.toString();
  };
  //Note: toArray() would be impossible without changing the layout of the array or lose the information about the sign
  P.toJSON=function (){
    if (ExpantaNum.serializeMode==ExpantaNum.JSON){
      var a=[];
      for (var i=0;i<this.array.length;++i) a.push([this.array[i][0],this.array[i][1]]);
      return {
        array:a,
        layer:this.layer,
        sign:this.sign
      };
    }else if (ExpantaNum.serializeMode==ExpantaNum.STRING){
      return this.toString();
    }
  };
  P.toHyperE=function (){
    if (this.layer) throw Error(expantaNumError+"Sorry, but this prototype doesn't support correct Hyper-E notation for numbers larger than 10{MSI}10");
    if (this.sign==-1) return "-"+this.abs().toFixed(2);
    if (isNaN(this.array[0][1])) return "NaN";
    if (!isFinite(this.array[0][1])) return "Infinity";
    if (this.lt(ExpantaNum.MAX_SAFE_INTEGER)) return String(this.array[0][1].toFixed(2));
    if (this.lt(ExpantaNum.E_MAX_SAFE_INTEGER)) return "E"+(this.array[0][1]).toFixed(2);
    var r="E"+this.operator(0).toFixed(2)+"#"+this.operator(1);
    var l=1;
    for (var i=Math.ceil(this.getOperatorIndex(2));i<this.array.length;++i){
      if (l+1<this.array[i][0]) r+="#1".repeat(this.array[i][0]-l-1);
      l=this.array[i][0];
      r+="#"+(this.array[i][1]+1);
    }
    if (!this.layer) r=""+r;
    else if (this.layer<3) r="J".repeat(this.layer)+r;
    else r="J^"+this.layer+" "+r;
    return r;
  };
  Q.fromNumber=function (input){
    if (typeof input!="number") throw Error(invalidArgument+"Expected Number");
    var x=new ExpantaNum();
    x.array[0][1]=Math.abs(input);
    x.sign=input<0?-1:1;
    x.standardize();
    return x;
  };
  Q.fromString=function (input){
    if (typeof input!="string") throw Error(invalidArgument+"Expected String");
    var isJSON=false;
    if (typeof input=="string"&&(input[0]=="["||input[0]=="{")){
      try {
        JSON.parse(input);
      }finally{
        isJSON=true;
      }
    }
    if (isJSON){
      return ExpantaNum.fromJSON(input);
    }
    var x=new ExpantaNum();
    x.array=[[0,0]];
    if (!isExpantaNum.test(input)){
      console.warn(expantaNumError+"Malformed input: "+input);
      x.array=[[0,NaN]];
      return x;
    }
    var negateIt=false;
    if (input[0]=="-"||input[0]=="+"){
      var numSigns=input.search(/[^-\+]/);
      var signs=input.substring(0,numSigns);
      negateIt=signs.match(/-/g).length%2==1;
      input=input.substring(numSigns);
    }
    if (input=="NaN") x.array=[[0,NaN]];
    else if (input=="Infinity") x.array=[[0,Infinity]];
    else{
      var a,b,c,d,i;
      if (input[0]=="J"){
        if (input[1]=="^"){
          a=input.substring(2).search(/[^0-9]/)+2;
          x.layer=Number(input.substring(2,a));
          input=input.substring(a+1);
        }else{
          a=input.search(/[^J]/);
          x.layer=a;
          input=input.substring(a);
        }
      }
      while (input){
        if (/^\(?10[\^\{]/.test(input)){
          if (input[0]=="("){
            input=input.substring(1);
          }
          var arrows;
          if (input[2]=="^"){
            a=input.substring(2).search(/[^\^]/);
            arrows=a;
            b=a+2;
          }else{
            a=input.indexOf("}");
            arrows=Number(input.substring(3,a));
            b=a+1;
          }
          input=input.substring(b);
          if (input[0]==")"){
            a=input.indexOf(" ");
            c=Number(input.substring(2,a));
            input=input.substring(a+1);
          }else{
            c=1;
          }
          if (arrows==1){
            if (x.array.length>=2&&x.array[1][0]==1){
              x.array[1][1]+=c;
            }else{
              x.array.splice(1,0,[1,c]);
            }
          }else if (arrows==2){
            a=x.array.length>=2&&x.array[1][0]==1?x.array[1][1]:0;
            b=x.array[0][1];
            if (b>=1e10) ++a;
            if (b>=10) ++a;
            x.array[0][1]=a;
            if (x.array.length>=2&&x.array[1][0]==1) x.array.splice(1,1);
            d=x.getOperatorIndex(2);
            if (Number.isInteger(d)) x.array[d][1]+=c;
            else x.array.splice(Math.ceil(d),0,[2,c]);
          }else{
            a=x.operator(arrows-1);
            b=x.operator(arrows-2);
            if (b>=10) ++a;
            d=x.getOperatorIndex(arrows);
            x.array.splice(1,Math.ceil(d)-1);
            x.array[0][1]=a;
            if (Number.isInteger(d)) x.array[1][1]+=c;
            else x.array.splice(1,1,[arrows,c]);
          }
        }else{
          break;
        }
      }
      a=input.split(/[Ee]/);
      b=[x.array[0][1],0];
      c=1;
      for (i=a.length-1;i>=0;--i){
        if (a[i]) d=Number(a[i]);
        else d=1;
        //The things that are already there
        if (b[0]<MAX_E&&b[1]===0){
          b[0]=Math.pow(10,c*b[0]);
        }else if (c==-1){
          if (b[1]===0){
            b[0]=Math.pow(10,c*b[0]);
          }else if (b[1]==1&&b[0]<=Math.log10(Number.MAX_VALUE)){
            b[0]=Math.pow(10,c*Math.pow(10,b[0]));
          }else{
            b[0]=0;
          }
          b[1]=0;
        }else{
          b[1]++;
        }
        //Multiplying coefficient
        if (b[1]===0){
          b[0]*=Number(d);
        }else if (b[1]==1){
          b[0]+=Math.log10(Number(d));
        }else if (b[1]==2&&b[0]<MAX_E+Math.log10(Math.log10(Number(d)))){
          b[0]+=Math.log10(1+Math.pow(10,Math.log10(Math.log10(Number(d)))-b[0]));
        }
        //Carrying
        if (b[0]<MAX_E&&b[1]){
          b[0]=Math.pow(10,b[0]);
          b[1]--;
        }else if (b[0]>MAX_SAFE_INTEGER){
          b[0]=Math.log10(b[0]);
          b[1]++;
        }
      }
      x.array[0][1]=b[0];
      if (b[1]){
        if (x.array.length>=2&&x.array[1][0]==1) x.array[1][1]+=b[1];
        else x.array.splice(1,0,[1,b[1]]);
      }
    }
    if (negateIt) x.sign*=-1;
    x.standardize();
    return x;
  };
  Q.fromArray=function (input1,input2,input3){
    var array,layer,sign;
    if (input1 instanceof Array&&(input2===undefined||typeof input2=="number")&&(input3===undefined||typeof input3=="number")){
      array=input1;
      sign=input2;
      layer=input3||0;
    }else if (typeof input1=="number"&&input2 instanceof Array&&(input3===undefined||typeof input3=="number")){
      array=input2;
      sign=input1;
      layer=input3||0;
    }else if (typeof input1=="number"&&typeof input2=="number"&&input3 instanceof Array){
      array=input3;
      sign=input1;
      layer=input2;
    }else{
      throw Error(invalidArgument+"Expected an Array [and 1 or 2 Number]");
    }
    var x=new ExpantaNum();
    var i;
    if (!array.length) x.array=[[0,0]];
    else if (typeof array[0]=="number"){
      x.array=[];
      for (i=0;i<array.length;i++){
        if (typeof array[i]!="number") throw Error(invalidArgument+"Expected Array of Number");
        x.array.push([i,array[i]]);
      }
    }else if (array[0] instanceof Array){
      x.array=[];
      for (i=0;i<array.length;i++){
        if (!(array[i] instanceof Array)||typeof array[i][0]!="number"||typeof array[i][1]!="number") throw Error(invalidArgument+"Expected Array of pair of Number");
        x.array.push([array[i][0],array[i][1]]);
      }
    }else throw Error(invalidArgument+"Expected Array of Number or Array of pair of Number");
    if (sign) x.sign=Number(sign);
    else x.sign=1;
    x.standardize();
    return x;
  };
  Q.fromObject=function (input){
    if (typeof input!="object") throw Error(invalidArgument+"Expected Object");
    if (input===null) return ExpantaNum.ZERO.clone();
    if (input instanceof Array) return ExpantaNum.fromArray(input);
    if (input instanceof ExpantaNum) return new ExpantaNum(input);
    if (!(input.array instanceof Array)) throw Error(invalidArgument+"Expected that property 'array' exists");
    if (input.sign!==undefined&&typeof input.sign!="number") throw Error(invalidArgument+"Expected that property 'sign' is Number");
    if (input.layer!==undefined&&typeof input.layer!="number") throw Error(invalidArgument+"Expected that property 'layer' is Number");
    return ExpantaNum.fromArray(input.array,input.sign,input.layer);
    /*var x=new ExpantaNum();
    x.array=[];
    for (var i=0;i<input.array.length;i++) x.array.push([input.array[i][0],input.array[i][1]]);
    x.sign=Number(input.sign)||1;
    x.layer=Number(input.layer)||0;
    x.standardize();
    return x;*/
  };
  Q.fromJSON=function (input){
    if (typeof input=="object") return ExpantaNum.fromObject(parsedObject);
    if (typeof input!="string") throw Error(invalidArgument+"Expected String");
    var parsedObject,x;
    try{
      parsedObject=JSON.parse(input);
    }catch(e){
      parsedObject=null;
      throw e;
    }finally{
      x=ExpantaNum.fromObject(parsedObject);
    }
    parsedObject=null;
    return x;
  };
  Q.fromHyperE=function (input){
    if (typeof input!="string") throw Error(invalidArgument+"Expected String");
    var x=new ExpantaNum();
    x.array=[[0,0]];
    if (!/^[-\+]*(0|[1-9]\d*(\.\d*)?|Infinity|NaN|E[1-9]\d*(\.\d*)?(#[1-9]\d*)*)$/.test(input)){
      console.warn(expantaNumError+"Malformed input: "+input);
      x.array=[[0,NaN]];
      return x;
    }
    var negateIt=false;
    if (input[0]=="-"||input[0]=="+"){
      var numSigns=input.search(/[^-\+]/);
      var signs=input.substring(0,numSigns);
      negateIt=signs.match(/-/g).length%2===0;
      input=input.substring(numSigns);
    }
    if (input=="NaN") x.array=[[0,NaN]];
    else if (input=="Infinity") x.array=[[0,Infinity]];
    else if (input[0]!="E"){
      x.array[0][1]=Number(input);
    }else if (input.indexOf("#")==-1){
      x.array[0][1]=Number(input.substring(1));
      x.array[1]=[1,1];
    }else{
      var array=input.substring(1).split("#");
      for (var i=0;i<array.length;++i){
        var t=Number(array[i]);
        if (i>=2){
          --t;
        }
        x.array[i]=[i,t];
      }
    }
    if (negateIt) x.sign*=-1;
    x.standardize();
    return x;
  };
  P.getOperatorIndex=function (i){
    if (typeof i!="number") i=Number(i);
    if (!isFinite(i)) throw Error(invalidArgument+"Index out of range.");
    var a=this.array;
    var min=0,max=a.length-1;
    if (a[max][0]<i) return max+0.5;
    if (a[min][0]>i) return -0.5;
    while (min!=max){
      if (a[min][0]==i) return min;
      if (a[max][0]==i) return max;
      var mid=Math.floor((min+max)/2);
      if (min==mid||a[mid][0]==i){
        min=mid;
        break;
      }
      if (a[mid][0]<i) min=mid;
      if (a[mid][0]>i) max=mid;
    }
    return a[min][0]==i?min:min+0.5;
  };
  P.getOperator=function (i){
    if (typeof i!="number") i=Number(i);
    if (!isFinite(i)) throw Error(invalidArgument+"Index out of range.");
    var ai=this.getOperatorIndex(i);
    if (Number.isInteger(ai)) return this.array[ai][1];
    else return i===0?10:0;
  };
  P.setOperator=function (i,value){
    if (typeof i!="number") i=Number(i);
    if (!isFinite(i)) throw Error(invalidArgument+"Index out of range.");
    var ai=this.getOperatorIndex(i);
    if (Number.isInteger(ai)) this.array[ai][1]=value;
    else{
      ai=Math.ceil(ai);
      this.array.splice(ai,0,[i,value]);
    }
    this.standardize();
  };
  P.operator=function (i,value){
    if (value===undefined) return this.getOperator(i);
    else this.setOperator(i,value);
  };
  P.clone=function (){
    var temp=new ExpantaNum();
    var array=[];
    for (var i=0;i<this.array.length;++i) array.push([this.array[i][0],this.array[i][1]]);
    temp.array=array;
    temp.sign=this.sign;
    temp.layer=this.layer;
    return temp;
  };
  // ExpantaNum methods

  /*
   *  clone
   *  config/set
   */

  /*
   * Create and return a ExpantaNum constructor with the same configuration properties as this ExpantaNum constructor.
   *
   */
  function clone(obj) {
    var i, p, ps;
    function ExpantaNum(input,input2) {
      var x=this;
      if (!(x instanceof ExpantaNum)) return new ExpantaNum(input,input2);
      x.constructor=ExpantaNum;
      var parsedObject=null;
      if (typeof input=="string"&&(input[0]=="["||input[0]=="{")){
        try {
          parsedObject=JSON.parse(input);
        }catch(e){
          //lol just keep going
        }
      }
      var temp,temp2,temp3;
      if (typeof input=="number"&&!(input2 instanceof Array)){
        temp=ExpantaNum.fromNumber(input);
      }else if (parsedObject){
        temp=ExpantaNum.fromObject(parsedObject);
      }else if (typeof input=="string"&&input[0]=="E"){
        temp=ExpantaNum.fromHyperE(input);
      }else if (typeof input=="string"){
        temp=ExpantaNum.fromString(input);
      }else if (input instanceof Array||input2 instanceof Array){
        temp=ExpantaNum.fromArray(input,input2);
      }else if (input instanceof ExpantaNum){
        temp=[];
        for (var i=0;i<input.array.length;++i) temp.push([input.array[i][0],input.array[i][1]]);
        temp2=input.sign;
        temp3=input.layer;
      }else if (typeof input=="object"){
        temp=ExpantaNum.fromObject(input);
      }else{
        temp=[[0,NaN]];
        temp2=1;
        temp3=0;
      }
      if (typeof temp2=="undefined"){
        x.array=temp.array;
        x.sign=temp.sign;
        x.layer=temp.layer;
      }else{
        x.array=temp;
        x.sign=temp2;
        x.layer=temp3;
      }
      return x;
    }
    ExpantaNum.prototype = P;

    ExpantaNum.JSON = 0;
    ExpantaNum.STRING = 1;
    
    ExpantaNum.NONE = 0;
    ExpantaNum.NORMAL = 1;
    ExpantaNum.ALL = 2;

    ExpantaNum.clone=clone;
    ExpantaNum.config=ExpantaNum.set=config;
    
    //ExpantaNum=Object.assign(ExpantaNum,Q);
    for (var prop in Q){
      if (Q.hasOwnProperty(prop)){
        ExpantaNum[prop]=Q[prop];
      }
    }
    
    if (obj === void 0) obj = {};
    if (obj) {
      ps = ['maxOps', 'serializeMode', 'debug'];
      for (i = 0; i < ps.length;) if (!obj.hasOwnProperty(p = ps[i++])) obj[p] = this[p];
    }

    ExpantaNum.config(obj);
    
    return ExpantaNum;
  }

  function defineConstants(obj){
    for (var prop in R){
      if (R.hasOwnProperty(prop)){
        if (Object.defineProperty){
          Object.defineProperty(obj,prop,{
            configurable: false,
            enumerable: true,
            writable: false,
            value: new ExpantaNum(R[prop])
          });
        }else{
          obj[prop]=new ExpantaNum(R[prop]);
        }
      }
    }
    return obj;
  }

  /*
   * Configure global settings for a ExpantaNum constructor.
   *
   * `obj` is an object with one or more of the following properties,
   *
   *   precision  {number}
   *   rounding   {number}
   *   toExpNeg   {number}
   *   toExpPos   {number}
   *
   * E.g. ExpantaNum.config({ precision: 20, rounding: 4 })
   *
   */
  function config(obj){
    if (!obj||typeof obj!=='object') {
      throw Error(expantaNumError+'Object expected');
    }
    var i,p,v,
      ps = [
        'maxOps',1,Number.MAX_SAFE_INTEGER,
        'serializeMode',0,1,
        'debug',0,2
      ];
    for (i = 0; i < ps.length; i += 3) {
      if ((v = obj[p = ps[i]]) !== void 0) {
        if (Math.floor(v) === v && v >= ps[i + 1] && v <= ps[i + 2]) this[p] = v;
        else throw Error(invalidArgument + p + ': ' + v);
      }
    }

    return this;
  }


  // Create and configure initial ExpantaNum constructor.
  ExpantaNum=clone(ExpantaNum);

  ExpantaNum=defineConstants(ExpantaNum);

  ExpantaNum['default']=ExpantaNum.ExpantaNum=ExpantaNum;

  // Export.

  // AMD.
  if (typeof define == 'function' && define.amd) {
    define(function () {
      return ExpantaNum;
    });
  // Node and other environments that support module.exports.
  } else if (typeof module != 'undefined' && module.exports) {
    module.exports = ExpantaNum;
    // Browser.
  } else {
    if (!globalScope) {
      globalScope = typeof self != 'undefined' && self && self.self == self
        ? self : Function('return this')();
    }
    globalScope.ExpantaNum = ExpantaNum;
  }
})(this);
let N = a => ExpantaNum(a)
class Game {
  constructor( d={} ) {
    this.matter = N(d.matter || 10)
    this.mg1c = N(d.mg1c || 10)
    this.mg1p = N(d.mg1p || 1)
    this.mg1a = N(d.mg1a || 0)
    this.mg1b = N(d.mg1b || 0)
    this.mg2c = N(d.mg2c || 500)
    this.mg3c = N(d.mg3c || 25000)
    this.mg4c = N(d.mg4c || 200)
    this.mg2a = N(d.mg2a || 0)
    this.mg3a = N(d.mg3a || 0)
    this.mg4a = N(d.mg4a || 0)
    this.mg2b = N(d.mg2b || 0)
    this.mg3b = N(d.mg3b || 0)
    this.mg4b = N(d.mg4b || 0)
    this.mg2p = N(d.mg2p || 1)
    this.mg3p = N(d.mg3p || 1)
    this.mg4p = N(d.mg4p || 1)
    this.mg2u = d.mg2u || false
    this.mg3u = d.mg3u || false
    this.mg4u = d.mg4u || false
    // pre mf ^
    this.mfu = d.mfu || false
    this.mft = N(d.mft || 0)
    this.atoms = N(d.atoms || 0)
    this.timf = N(d.timf || 0)
    this.per10 = N(d.per10 || 1.5)
    this.mg5u = d.mg5u || false
    this.mg5a = N(d.mg5a || 0)
    this.mg5c = N(d.mg5c || 1e13)
    this.mg5b = N(d.mg5b || 0)
    this.mg5boost = N(d.mg5boost || 1)
    this.mg5p = N(d.mg5p || 1)
    this.settings = d.settings || {
        mfw: true,
        mfwu: false,
        notationstate: 0
      }
    this.upgrades = d.upgrades || {
      u1: false,
      u2: false,
      u3: false,
      u4: false,
      u5: false,
      u6: false,
      u7: false,
      u8: false,
      u9: false,
      u10: false,
      u11: false,
      u12: false,
      u13: false,
      u14: false,
      u15: false,

    }
    this.upgradesbought = N(d.upgradesbought || 0)
    this.mg6a = N(d.mg6a || 0)
    this.mg6b = N(d.mg6b || 0)
    this.mg6p = N(d.mg6p || 1)
    this.mg6c = N(d.mg6c || 1e60)
    this.mg6u = d.mg6u || false 
    this.chal = d.chal || {
      c1: false,
      c2: false,
      c3: false,
      c4: false,
    }
    this.chalin = d.chalin || 0
    this.auto = d.auto || {
      tiers: [0,0,0,0,0,0,0],
      active: [false,false,false,false,false,false,false],
      mftype: "amount"
    }
    this.mfp = N(d.mfp || 0)
    this.acv = d.acv || {
      10:false,
      11:false,
      12:false,
      13:false,
      14:false,
      15:false,
      16:false,
      17:false,
      18:false,
      19:false,
      20:false,
      21:false,
      22:false,
      23:false,
      24:false,
      25:false,
      26:false,
      27:false,
      28:false,
      29:false,
      30:false,
      31:false,
      32:false,
      33:false,
      34:false,
      35:false,
      36:false,
      37:false,
      38:false,
      39:false,
    }
  }
}
function boolvert(a) {
  if (!a) {
    return N(0)
  } else {
    return N(1)
  }
}
// 0 = scientific
// 1 = cancer
// 2 = log
// 3 hyperEEEEEEEEEEEEEEEEEEE
// 4 infinity
function changenotation() {
  if (game.settings.notationstate === 4) {
    game.settings.notationstate = 0
    document.getElementById("notationbutton").textContent = "Notation: Scientific"
  } else if (game.settings.notationstate === 0) {
    game.settings.notationstate++
    document.getElementById("notationbutton").textContent = "Notation: Cancer"
  } else if (game.settings.notationstate === 1) {
    game.settings.notationstate++
    document.getElementById("notationbutton").textContent = "Notation: Logarithmic"
  } else if (game.settings.notationstate === 2) {
    game.settings.notationstate++
    document.getElementById("notationbutton").textContent = "Notation: HyperE"
  } else if (game.settings.notationstate === 3) {
    game.settings.notationstate++
    document.getElementById("notationbutton").textContent = "Notation: Infinity"
  }
}
function repeatfunction(func,param,times) {
  while (times > 0) {
    times--
    if (param === undefined) {
      func()
    } else {
      func(param)
    }
  }
}
function clearsave() {
  if(confirm("Are you sure you want to wipe your save?")) {
    game = new Game()
    localStorage.removeItem("save")
  }
}
function gTT(a) {
  switch (a) {
    case 1:
      document.getElementById("mgs").hidden = false
      document.getElementById("mftab").hidden = true
      document.getElementById("sett").hidden = true
      document.getElementById("auto").hidden = true
      document.getElementById("challenges").hidden = true
      document.getElementById("achivements").hidden = true
      break;
    case 2:
      document.getElementById("mgs").hidden = true
      document.getElementById("mftab").hidden = false
      document.getElementById("sett").hidden = true
      document.getElementById("auto").hidden = true
      document.getElementById("challenges").hidden = true
      document.getElementById("achivements").hidden = true
      break;
    case 3:
      document.getElementById("mgs").hidden = true
      document.getElementById("mftab").hidden = true
      document.getElementById("sett").hidden = false
      document.getElementById("auto").hidden = true
      document.getElementById("challenges").hidden = true
      document.getElementById("achivements").hidden = true
      break;
    case 4:
      document.getElementById("mgs").hidden = true
      document.getElementById("mftab").hidden = true
      document.getElementById("sett").hidden = true
      document.getElementById("auto").hidden = true
      document.getElementById("challenges").hidden = false
      document.getElementById("achivements").hidden = true
      break;
    case 5:
      document.getElementById("mgs").hidden = true
      document.getElementById("mftab").hidden = true
      document.getElementById("sett").hidden = true
      document.getElementById("auto").hidden = false
      document.getElementById("challenges").hidden = true
      document.getElementById("achivements").hidden = true
      break;
    case 6:
      document.getElementById("mgs").hidden = true
      document.getElementById("mftab").hidden = true
      document.getElementById("sett").hidden = true
      document.getElementById("auto").hidden = true
      document.getElementById("challenges").hidden = true
      document.getElementById("achivements").hidden = false
      break;
  }
}
//ty reinhardt-c x2
//GAME START
function save() {
let m = JSON.stringify(game)
localStorage.setItem("save",m)
}
function load(sv) {
  let s = sv || localStorage.getItem("save")
  if (s != null && s != "undefined") {
    s = JSON.parse(s)
    game = new Game(s)
    return true
  } else {
  return false
  }
}
function getAOR() {
  if (game.upgrades.u15) {
    return N(8).pow(game.matter.logBase(17.9).div(30.8)).mul((gum(9)).pow(gum(14)))
  } else if (game.upgrades.u7) {
    return N(7).pow(game.matter.logBase(17.9).div(30.8)).mul((gum(9)).pow(gum(14)))
  } else {
    return N(7).pow(game.matter.logBase(17.9).div(150)).mul((gum(9)).pow(gum(14)))
  }
}
var sa = setInterval(save,700)
var game
if (!load()) {
  game = new Game()
}
function getMPS() {
  if (game.chalin === 4) {
    var aae = N(3000).div(game.timf.div(20).add(3000))
  } else {
    var aae = N(1)
  }
  var a = (game.mg1a.pow(1.2).mul(game.mg1p)).pow(aae)
  var b = (game.mg2a.pow(1.22).mul(15).mul(game.mg2p)).pow(aae)
  var c = (game.mg3a.pow(1.4).mul(1500).mul(game.mg3p)).pow(aae)
  var d = ((N(10).pow(game.mg5a.pow(4).logBase(9).mul(2.4))).mul(game.mg5p)).pow(aae)
  return a.add(b).add(c).add(d)
}
function generate() {
  if (game.chalin === 4) {
    var aae = N(3000).div(game.timf.div(20).add(3000))
  } else {
    var aae = N(1)
  }
  game.matter = game.matter.add((getMPS().div(20)))
  game.mg1a = game.mg1a.add((((game.mg2a.div(6).pow(0.8)).div(20)).mul(game.mg2p)).pow(aae))
  game.mg2a = game.mg2a.add((((game.mg4a.div(4).pow(0.73)).div(20)).mul(game.mg4p)).pow(aae))
  game.mg5boost = game.mg5boost.add((game.mg5a.pow(1.1).mul(0.001).mul(game.mg5p).div(20)).pow(aae))
  game.mg3a = game.mg3a.add((game.mg6a.pow(2.5).mul(1e10).mul(game.mg6p).div(20)).pow(aae))
}
//code from https://github.com/aarextiaokhiao/IvarK.github.io/blob/master/javascripts/core/format.js
function letter(power, str) {
	const len = str.length;
    let ret = ''
	power = Math.floor(power / 3)
	let skipped = Math.floor(Math.log10(power*(len-1)+1)/Math.log10(len))-7
	if (skipped < 4) skipped = 0
	else power = Math.floor((power-(Math.pow(len,skipped)-1)/(len-1)*len)/Math.pow(len,skipped))
	while (power > 0) {
		ret = str[(power - 1) % len] + ret
		power = Math.ceil(power / len) - 1
	}
	if (skipped) ret += "[" + skipped + "]"
	return ret
}
function fix(a) {
  if (game.settings.notationstate === 0) {
      if (a.gte(1e17) && a.lte("1e100")) {
        return a.toFixed(2)
      } else if (a.gte(1e3)) {
        var aa = a.logBase(10)
        var ab = aa.floor()
        var ac = aa.sub(ab)
        var ad = N(10).pow(ac).toFixed(2)
        return ad + "e" + ab
      } else {
        return a.toFixed(2)
      }
  } else if (game.settings.notationstate === 1) {
    if (a.gte(1e3)) {
      var ba = a.logBase(10)
      var bb = ba.mod(3)
      var bc = N(10).pow(bb)
      var bd = ba.floor()
      var cancer = ['😠', '🎂', '🎄', '💀', '🍆', '👪', '🌈', '💯', '🍦', '🎃', '💋', '😂', '🌙', '⛔', '🐙', '💩', '❓', '☢', '🙈', '👍', '☂', '✌', '⚠', '❌', '😋', '⚡']
      return bc.toFixed(2) + letter(bd.toNumber(),cancer)
    } else {
      return a.toFixed(2)
    }
  } else if (game.settings.notationstate === 2) {
    return "e" + a.logBase(10).toFixed(2)
  } else if (game.settings.notationstate === 3) {
    if (a.lt(1e20)) {
      return "E" + a.logBase(10).toFixed(2)
    } else {
      return a.toHyperE()
    }
  } else if (game.settings.notationstate === 4) {
    return a.logBase(1.79e308).toFixed(4) + "∞"
  }
}
function mf() {
  if (game.mfu) {
    if (game.settings.mfw) {
      if (confirm("Doing a Matter Fusion will reset almost all of your progress leading up to this point for atoms.")) {
        mfr()
      }
    } else {
      mfr()
    }
  }
}
function startchal(chal) {
  mfr(2)
  game.chalin = chal
  switch (chal) {
    case 1:
      clearInterval(uin)
      uin = setInterval(update,250)
    break;
  }
}
function mfr(c) {
  if (c === undefined) {
    game.atoms = game.atoms.add(getAOR())
  }
  clearInterval(uin)
  uin = setInterval(update,50)
  if (game.upgrades.u12) {
    game.matter = N(1e7).add(gum(12))
  } else if (game.upgrades.u5) {
    game.matter = N(1e7)
  } else {
    game.matter = N(10)
  }
  game.mg1a = N(0)
  game.mg2a = N(0)
  game.mg3a = N(0)
  game.mg4a = N(0)
  game.mg5a = N(0)
  game.mg6a = N(0)
  game.mg1c = N(10)
  game.mg2c = N(500)
  game.mg3c = N(25000)
  game.mg4c = N(200)
  game.mg5c = N(1e13)
  game.mg6c = N(1e60)
  game.mg1b = N(0)
  game.mg2b = N(0)
  game.mg3b = N(0)
  game.mg4b = N(0)
  game.mg5b = N(0)
  game.mg6b = N(0)
  game.mg1p = N(1)
  game.mg2p = N(1)
  game.mg3p = N(1)
  game.mg4p = N(1)
  game.mg5p = N(1)
  game.mg6p = N(1)
  game.mg2u = false
  game.mg3u = false   
  game.mg4u = false
  game.mg5u = false
  game.mg6u = false
  game.mg5boost = N(1)
  game.mft = game.mft.add(1)
  game.mfu = false
  game.timf = N(0)
  game.mfp = N(0)
}
function gum(a) {
  switch (a) {
    case 1:
      if (game.upgrades.u11) {
        return ((game.mg1a.add(1)).mul((game.mg2a.add(1)).mul((game.mg4a.add(1)).mul((game.mg5a.add(1)).mul((game.mg6a.add(1))))))).pow(0.55)
      }
      var aa = game.mg1b.div(5).mul(game.mg2b.div(4).mul(game.mg4b.div(2)))
      var ab = (game.mg1b.add(game.mg2b.add(game.mg4b))).mul(1.2)
      return ((aa.pow(1.13)).mul(ab).mul(boolvert(game.upgrades.u1))).add(1)
    case 6:
      var ba = (game.atoms.add(1)).logBase(2)
      var bb = (game.mft.add(1)).logBase(3)
      return (ba.pow(bb).mul(boolvert(game.upgrades.u6))).add(1)
    case 9:
      var ca = (game.mft.add(1)).logBase(2)
      return (ca.div(3).mul(boolvert(game.upgrades.u9))).add(1)
    case 12:
      return game.matter.pow(0.12)
    case 14:
      return N(document.getElementsByClassName("acvc").length/7).mul(boolvert(game.upgrades.u14))
  }
}
function changepower() {
  if (game.chalin === 2) {
    var aad = 20
  } else {
    var aad = 10
  }
  game.mg1p = game.per10.pow((game.mg1b.div(aad)).floor()).mul(game.mg5boost).mul(gum(6))
  game.mg2p = game.per10.pow((game.mg2b.div(aad)).floor()).mul(gum(6))
  game.mg3p = game.per10.pow((game.mg3b.div(aad)).floor()).mul(game.mg5boost).mul(gum(1)).mul(gum(6))
  game.mg4p = game.per10.pow((game.mg4b.div(aad)).floor()).mul(gum(6))
  game.mg5p = game.per10.pow((game.mg5b.div(aad)).floor()).mul(gum(6))
  game.mg6p = game.per10.pow((game.mg6b.div(aad)).floor()).mul(gum(6))
}
function getAchivements() {
  if(game.mg1b.gte(1))game.acv[10]=true
  if(game.mg1b.gte(40))game.acv[11]=true
  if(game.mg2b.gte(1))game.acv[12]=true
  if(game.mg2b.gte(10))game.acv[13]=true
  if(game.mg3u)game.acv[14]=true
  if(game.mg4u)game.acv[15]=true
  if(game.matter.gte(1e6))game.acv[16]=true
  if(game.mg3b.gte(14))game.acv[17]=true
  if(game.mg2b.gte(10))game.acv[18]=true
  if(game.atoms.gte(1))game.acv[19]=true
  if(game.upgrades.u3)game.acv[20]=true
  if(game.mg5b.gte(1))game.acv[21]=true
  if(game.matter.gte(1e55))game.acv[22]=true
  if(game.upgrades.u6)game.acv[23]=true
  if(game.mg6u)game.acv[24]=true
  if(game.atoms.gte(100))game.acv[25]=true
  if(game.upgrades.u10)game.acv[26]=true
  if(game.chal.c1&&game.chal.c2)game.acv[27]=true
  if(game.chal.c4)game.acv[28]=true
  if(!game.auto.tiers.includes(1)&&!game.auto.tiers.includes(0))game.acv[29]=true
  if(game.matter.gte(1e150)) game.acv[30]=true
  if(game.mg1b.gt(2150)||game.mg2b.gt(1600)||game.mg3b.gt(930)||game.mg4b.gt(260)||game.mg5b.gt(1300)||game.mg6b.gt(970))game.acv[31]=true
  if(getAOR().gte(1e4)) game.acv[32]=true
  if(!game.auto.tiers.includes(1)&&!game.auto.tiers.includes(2)&&!game.auto.tiers.includes(0))game.acv[33]=true
  if(game.atoms.gte(1e7))game.acv[34]=true
  if(game.mft.gte(10000))game.acv[35]=true
  if(game.mg1a.eq(game.mg1b)&&game.mg1a.gte(315)&&game.mg3a.lte(0)&&game.mg6a.lte(0))game.acv[36]=true
  if(game.upgrades.u14)game.acv[37]=true
  if(game.upgrades.u15)game.acv[38]=true
  if(game.matter.gte(N(2).pow(1024)))game.acv[39]=true
}
function update() {
  if (game.chalin === 4) {
    var aae = N(1500).div(game.timf.add(1500))
  } else {
    var aae = N(1)
  }
  var aaj
  for (aaj in game.acv) {
    if (game.acv[aaj]) {
      document.getElementById("a"+aaj).className = "acvc"
    }
  }
  generate()
  getAchivements()
  document.getElementById("c1g").textContent = fix(N(1e43))
  document.getElementById("c2g").textContent = fix(N(1e28))
  document.getElementById("c3g").textContent = fix(N(1e65))
  document.getElementById("c4g").textContent = fix(N(1e75))
  document.getElementById("mg1a").textContent = "Amount: " + fix(game.mg1a)
  document.getElementById("mg1p").textContent = "Production: " + fix((game.mg1a.pow(1.2).mul(game.mg1p)).pow(aae)) + " matter / sec"
  document.getElementById("mg2a").textContent = "Amount: " + fix(game.mg2a)
  document.getElementById("mg2p").innerHTML = "Production: " + fix((game.mg2a.pow(1.22).mul(15).mul(game.mg2p)).pow(aae)) + " matter / sec <br> Production: " + fix((game.mg2a.div(6).pow(0.8).mul(game.mg2p)).pow(aae)) + " mg1 / sec"
  document.getElementById("mg3a").textContent = "Amount: " + fix(game.mg3a)
  document.getElementById("mg3p").textContent = "Production: " + fix((game.mg3a.pow(1.4).mul(1500).mul(game.mg3p)).pow(aae)) + " matter / sec"
  document.getElementById("mg4a").textContent = "Amount: " + fix(game.mg4a)
  document.getElementById("mg4p").textContent = "Production: " + fix(((game.mg4a.div(4)).pow(0.73).mul(game.mg4p)).pow(aae)) + " mg2 / sec"
  document.getElementById("man").textContent = fix(game.matter)
  document.getElementById("bc1").textContent = fix(game.mg1c)
  document.getElementById("bc2").textContent = fix(game.mg2c)
  document.getElementById("bc3").textContent = fix(game.mg3c)
  document.getElementById("bc4").textContent = fix(game.mg4c)
  document.getElementById("bc5").textContent = fix(game.mg5c)
  document.getElementById("bc6").textContent = fix(game.mg6c)
  document.getElementById("mg5a").textContent = "Amount: " + fix(game.mg5a)
  document.getElementById("mg5p").innerHTML = "Production: " + fix((N(10).pow(game.mg5a.pow(4).logBase(9).mul(2.4)).mul(game.mg5p)).pow(aae)) + " matter / sec <br> Production: " + fix((game.mg5a.pow(1.1).mul(0.001).mul(game.mg5p)).pow(aae)) + "x mg1 + mg3 power / sec"
  document.getElementById("mg6a").textContent = "Amount: " + fix(game.mg6a)
  document.getElementById("mg6p").textContent = "Production: " + fix((game.mg6a.pow(2.5).mul(1e10).mul(game.mg6p)).pow(aae)) + " mg3 / sec"
  document.getElementById("aomf").textContent = "Gain " + fix(getAOR()) + " Atoms"
  document.getElementById("apm").textContent = fix(getAOR().div(game.timf).mul(3000)) + " Atoms / minute"
  document.getElementById("atm").textContent = fix(game.atoms)
  document.getElementById("patm").textContent = fix(game.mfp)
  changepower()
  switch (game.chalin) {
    case 1:
      document.getElementById("chalp").textContent = (game.matter.logBase(10)).div(0.43).toFixed(3) + "%"
    break;
    case 2:
      document.getElementById("chalp").textContent = (game.matter.logBase(10)).div(0.28).toFixed(3) + "%"
    break;
    case 3:
      document.getElementById("chalp").textContent = (game.matter.logBase(10)).div(0.65).toFixed(3) + "%"
    break;
    case 4:
      document.getElementById("chalp").textContent = (game.matter.logBase(10)).div(0.75).toFixed(3) + "%"
    break;
  }
  if (game.upgrades.u13) {
    game.per10 = N(2.1)
  } else if (game.upgrades.u2) {
    game.per10 = N(1.55)
  } else {
    game.per10 = N(1.5)
  }
  if (game.chalin) {
    document.getElementById("sc"+game.chalin).className = "ca"
    document.getElementById("sc"+game.chalin).textContent = "Active"
  } else {
    document.getElementById("sc1").className = "simpbutt"
    document.getElementById("sc1").textContent = "Start"
    document.getElementById("sc2").className = "simpbutt"
    document.getElementById("sc2").textContent = "Start"
    document.getElementById("sc4").className = "simpbutt"
    document.getElementById("sc4").textContent = "Start"
    document.getElementById("sc3").className = "simpbutt"
    document.getElementById("sc3").textContent = "Start"
  }
  document.getElementById("cc").hidden = !game.chalin
  game.timf = game.timf.add(1)
  if ((getAOR().div(game.timf).mul(3000).gte(game.mfp)) && game.matter.gte(1e12)) {
    game.mfp = getAOR().div(game.timf).mul(3000)
  }
  document.getElementById("u1e").textContent = "(" + fix(gum(1)) + "x)"
  document.getElementById("u6e").textContent = "(" + fix(gum(6)) + "x)"
  document.getElementById("u9e").textContent = "(" + fix(gum(9).pow(gum(14))) + "x)"
  document.getElementById("u11c").textContent = fix(N(1e4))
  document.getElementById("u12c").textContent = fix(N(3.5e4))
  document.getElementById("u13c").textContent = fix(N(1e5))
  document.getElementById("u14c").textContent = fix(N(2.5e5))
  document.getElementById("u15c").textContent = fix(N(1e7))
  document.getElementById("u12e").textContent = fix(gum(12))
  document.getElementById("u14e").textContent = fix(gum(14))
  document.getElementById("t")
  if (game.chalin === 3) {
    game.matter = game.matter.mul(0.95)
  }
  if (game.matter.gte(game.mg1c)) {
    document.getElementById("b1").className = "av bb"
  } else {
    document.getElementById("b1").className = "uav bb"
  }
  if (game.matter.gte(game.mg2c)) {
    document.getElementById("b2").className = "av bb"
  } else {
    document.getElementById("b2").className = "uav bb"
  }
  if (game.matter.gte(game.mg3c)) {
    document.getElementById("b3").className = "av bb"
  } else {
    document.getElementById("b3").className = "uav bb"
  }
  if (game.mg1a.gte(game.mg4c)) {
    document.getElementById("b4").className = "av bb"
  } else {
    document.getElementById("b4").className = "uav bb"
  }
  if (game.matter.gte(game.mg5c)) {
    document.getElementById("b5").className = "av bb"
  } else {
    document.getElementById("b5").className = "uav bb"
  }
  if (game.matter.gte(game.mg6c)) {
    document.getElementById("b6").className = "av bb"
  } else {
    document.getElementById("b6").className = "uav bb"
  }
  var aag = 0
  while (aag < 15) {
    if (game.upgrades["u"+(aag+1)]) {
      document.getElementById("u"+(aag+1)).className = "ub ubo"
    }
    aag++
  }
  /*mg1: starts at the 2150th mg1; new scaling: x1.4 each time
  mg2: starts at the 1600th mg1; new scaling: x1.7 each time
  mg3: starts at the 930th mg3; new scaling: x1.9 each time
  mg4: starts at the 260th mg4; new scaling: x1.55 each time
  mg5: starts at the 1300th mg5; new scaling: x1.6 each time
  mg6: starts at the 970th mg6; new scaling: x1.7 each time*/
  if (game.mg1b.gt(2150)) {
    document.getElementById("mg1sc").textContent = "Scaled "
  } else {
    document.getElementById("mg1sc").textContent = ""
  }
  if (game.mg2b.gt(1600)) {
    document.getElementById("mg2sc").textContent = "Scaled "
  } else {
    document.getElementById("mg2sc").textContent = ""
  }
  if (game.mg3b.gt(930)) {
    document.getElementById("mg3sc").textContent = "Scaled "
  } else {
    document.getElementById("mg3sc").textContent = ""
  }
  if (game.mg4b.gt(260)) {
    document.getElementById("mg4sc").textContent = "Scaled "
  } else {
    document.getElementById("mg4sc").textContent = ""
  }
  if (game.mg5b.gt(1300)) {
    document.getElementById("mg5sc").textContent = "Scaled "
  } else {
    document.getElementById("mg5sc").textContent = ""
  }
  if (game.mg6b.gt(970)) {
    document.getElementById("mg6sc").textContent = "Scaled "
  } else {
    document.getElementById("mg6sc").textContent = ""
  }
  if (game.atoms.gte(1) && !game.upgrades.u1) {
    document.getElementById("u1").className = "ub av"
  } else if (!game.upgrades.u1) {
    document.getElementById("u1").className = "ub uav"
  }
  if (game.atoms.gte(2) && !game.upgrades.u2) {
    document.getElementById("u2").className = "ub av"
  } else if (!game.upgrades.u2) {
    document.getElementById("u2").className = "ub uav"
  }
  if (game.atoms.gte(4) && !game.upgrades.u3) {
    document.getElementById("u3").className = "ub av"
  } else if (!game.upgrades.u3) {
    document.getElementById("u3").className = "ub uav"
  }
  if (game.atoms.gte(6) && !game.upgrades.u4) {
    document.getElementById("u4").className = "ub av"
  } else if (!game.upgrades.u4) {
    document.getElementById("u4").className = "ub uav"
  }
  if (game.atoms.gte(3) && !game.upgrades.u5 && game.upgradesbought.gte(4)) {
    document.getElementById("u5").className = "ub av"
  } else if (!game.upgrades.u5) {
    document.getElementById("u5").className = "ub uav"
  }
  if (game.atoms.gte(10) && !game.upgrades.u6) {
    document.getElementById("u6").className = "ub av"
  } else if (!game.upgrades.u6) {
    document.getElementById("u6").className = "ub uav"
  }
  if (game.atoms.gte(15) && !game.upgrades.u7) {
    document.getElementById("u7").className = "ub av"
  } else if (!game.upgrades.u7) {
    document.getElementById("u7").className = "ub uav"
  }
  if (game.atoms.gte(20) && !game.upgrades.u8) {
    document.getElementById("u8").className = "ub av"
  } else if (!game.upgrades.u8) {
    document.getElementById("u8").className = "ub uav"
  }
  if (game.atoms.gte(35) && !game.upgrades.u9) {
    document.getElementById("u9").className = "ub av"
  } else if (!game.upgrades.u9) {
    document.getElementById("u9").className = "ub uav"
  }
  if (game.atoms.gte(50) && !game.upgrades.u10 && game.upgradesbought.gte(9)) {
    document.getElementById("u10").className = "ub av"
  } else if (!game.upgrades.u10) {
    document.getElementById("u10").className = "ub uav"
  }
  if (game.atoms.gte(10e3) && !game.upgrades.u11) {
    document.getElementById("u11").className = "ub av"
  } else if (!game.upgrades.u11) {
    document.getElementById("u11").className = "ub uav"
  }
  if (game.atoms.gte(35e3) && !game.upgrades.u12) {
    document.getElementById("u12").className = "ub av"
  } else if (!game.upgrades.u12) {
    document.getElementById("u12").className = "ub uav"
  }
  if (game.atoms.gte(100e3) && !game.upgrades.u13) {
    document.getElementById("u13").className = "ub av"
  } else if (!game.upgrades.u13) {
    document.getElementById("u13").className = "ub uav"
  }
  if (game.atoms.gte(250e3) && !game.upgrades.u14) {
    document.getElementById("u14").className = "ub av"
  } else if (!game.upgrades.u14) {
    document.getElementById("u14").className = "ub uav"
  }
  if (game.atoms.gte(1e7) && !game.upgrades.u15 && game.upgradesbought.gte(14)) {
    document.getElementById("u15").className = "ub av"
  } else if (!game.upgrades.u15) {
    document.getElementById("u15").className = "ub uav"
  }
  var aab = 0
  while (aab < game.auto.tiers.length) {
    if (game.auto.tiers[aab] === 3) {
      document.getElementById(aab+1+"t").textContent = "Tier 3"
      document.getElementById(aab+1+"t").className = "bb ubo b"
    } else {
      document.getElementById((aab+1)+"t").textContent = "Tier: " + game.auto.tiers[aab] + "; Increase for " + fix(autocost(aab+1)) + " atoms"
      if (game.atoms.gte(autocost(aab+1))) {
        document.getElementById(aab+1+"t").className = "bb av b"
      } else {
        document.getElementById(aab+1+"t").className = "bb uav b"
      }
    }
    aab++
  }
  unlock()
  document.getElementById("a7t").textContent = game.auto.mftype
  document.getElementById("mg2").hidden = !game.mg2u
  document.getElementById("mg3").hidden = !game.mg3u
  document.getElementById("mg4").hidden = !game.mg4u
  document.getElementById("mfb").hidden = !game.mfu
  document.getElementById("mfw").hidden = !game.settings.mfwu
  document.getElementById("mg5").hidden = !game.mg5u
  document.getElementById("mg6").hidden = !game.mg6u
  document.getElementById("a16").setAttribute("tooltip","Mega-matter \n Reach " + fix(N(1e6)) + " matter.")
  document.getElementById("a19").setAttribute("tooltip","Thank you for listening to my suggestion \n Reach " + fix(N(1e20)) + " matter.")
  document.getElementById("a22").setAttribute("tooltip","Inflation \n Reach " + fix(N(1e55)) + " matter.")
  document.getElementById("a30").setAttribute("tooltip","Hyperinflation \n Reach " + fix(N(1e150)) + " matter.")
  document.getElementById("a32").setAttribute("tooltip","That's a lot of atoms! \n Reach " + fix(N(1e4)) + " atoms in a Matter Fusion.")
  document.getElementById("a34").setAttribute("tooltip","Stockpile \n Have " + fix(N(1e7)) + " atoms at once.")
  document.getElementById("a35").setAttribute("tooltip","Stop. \n Reach " + fix(N(1e4)) + " Matter Fusions.")
  document.getElementById("a39").setAttribute("tooltip","Infinity? \n Reach " + fix(N(2).pow(1024)) + " matter")
  autobuy()
  var aaf = 0
  while (aaf < 4) {
    if (game.chal["c"+(aaf+1)]) {
    document.getElementById("sc"+(aaf+1)).textContent = "Completed"
    document.getElementById("sc"+(aaf+1)).className = "cc"
  }
  aaf++
  }
}
function cc(a) {
  switch (a) {
    case 1:
      if (game.matter.gte(1e43)) {
        game.chalin = 0
        game.chal.c1 = true
        game.auto.tiers[4] = 1
      } else {
        game.chalin = 0
      }
    break;
    case 2:
      if (game.matter.gte(1e28)) {
        game.chalin = 0
        game.chal.c2 = true
        game.auto.tiers[5] = 1       
      } else {
        game.chalin = 0
      }
    case 3:
      if (game.matter.gte(1e65)) {
        game.chalin = 0
        game.chal.c3 = true
        game.auto.tiers[6] = 1
      } else {
        game.chalin = 0        
      }
    break;
    case 4:
      if (game.matter.gte(1e75)) {
        game.chalin = 0
        game.chal.c4 = true     
      } else {
        game.chalin = 0        
      }
  }
  mfr(2)
}
function autocost(ID) {
  switch (ID) {
    case 1:
    case 2:
      return N(100).mul(N(200).pow(game.auto.tiers[ID-1]-1))
    break;
    case 3:
    case 4:
      return N(250).mul(N(200).pow(game.auto.tiers[ID-1]-1))
    break;
    case 5:
    case 6:
      return N(400).mul(N(200).pow(game.auto.tiers[ID-1]-1))
    break;
    case 7:
      return N(200).mul(N(400).pow(game.auto.tiers[ID-1]-1))
    break;
  }
}
function autobuy() {
  var aal = document.getElementById("a7ta").value
    switch (game.auto.mftype) {
      case "amount":
        if (getAOR().gte(N(aal)) && game.mfu) {
          mfr()
        }
      break;
      case "time":
        if (game.timf.gte(N(aal).mul(20)) && game.mfu) {
          mfr()
        }
      break;
    }
  if (!game.upgrades.u10 && game.upgrades.u3) {
    document.getElementById("b1").click()
    document.getElementById("b2").click()
    document.getElementById("b3").click()
    document.getElementById("b4").click()
  } else if (game.upgrades.u10) {
    var aua = 0
    while (aua <= game.auto.tiers.length) {
      if (game.auto.tiers[aua] === 1 && game.auto.active[aua] && aua < 7) {
        repeatfunction(buyMG,aua+1,1)
      } else if (game.auto.tiers[aua] === 2 && game.auto.active[aua] && aua < 7) {
        repeatfunction(buyMG,aua+1,10)
      } else if (game.auto.tiers[aua] === 3 && game.auto.active[aua] && aua < 7) {
        repeatfunction(buyMG,aua+1,100)
      }
      aua++
    }
  }
}
document.getElementById("acb1").checked = game.auto.active[0]
document.getElementById("acb2").checked = game.auto.active[1]
document.getElementById("acb3").checked = game.auto.active[2]
document.getElementById("acb4").checked = game.auto.active[3]
document.getElementById("acb5").checked = game.auto.active[4]
document.getElementById("acb6").checked = game.auto.active[5]
document.getElementById("acb7").checked = game.auto.active[6]
function upTier(ID) {
  if (game.atoms.gte(autocost(ID)) && game.auto.tiers[ID-1] !== 3) {
    game.atoms = game.atoms.sub(autocost(ID))
    game.auto.tiers[ID-1]++
  }
}
function mfachange() {
  switch (game.auto.mftype) {
    case "amount":
      game.auto.mftype = "time"
    break;
    case "time":
      game.auto.mftype = "amount"
    break;
  }
}
function changeauto(type) {
  game.auto.active[type-1] = !game.auto.active[type-1]
}
function unlock() {
  if (!game.mg2u) {
  game.mg2u = game.mg1a.gte(60)
  }
  if (!game.mg3u) {
  game.mg3u = game.matter.gte(50000)
  }
  if (!game.mg4u) {
    game.mg4u = game.mg3a.gte(3)
  }
  if (!game.mg5u && game.upgrades.u4 && game.mg4a.gte(2)) {
    game.mg5u =  true
  }
  if (!game.mg6u && game.upgrades.u8 && game.matter.gt(1e55)) {
    game.mg6u = true
  }
  if (game.mft.lt(1)) {
    game.mfu = game.matter.gte(1e12) && !game.chalin
  } else if (game.matter.gte(1e12)) {
    game.mfu = true && !game.chalin
  }
  if (game.mft.gte(1)) {
    document.getElementById("mftb").hidden = false
  }
  if (!game.settings.mfwu) {
    game.settings.mfwu = game.mfu
  }
  if (game.upgrades.u5) {
    document.getElementById("r2").hidden = false
  }
  document.getElementById("ab5").hidden = !game.chal.c1
  document.getElementById("ab6").hidden = !game.chal.c2
  document.getElementById("ab7").hidden = !game.chal.c3
  document.getElementById("r3").hidden = !game.chal.c4
}
var uin
function mfwarning() {
  if (game.settings.mfw) {
    document.getElementById("mfw").textContent = "Turn on Matter Fusion warning"
  } else {
    document.getElementById("mfw").textContent = "Turn off Matter Fusion warning"
  }
  game.settings.mfw = !game.settings.mfw
}
if (game.chalin === 1) {
  uin = setInterval(update,250)
} else {
  uin = setInterval(update,50)
}
function buyMG(type) {
  if (type === 4) {
    if (game.mg1a.gte(game.mg4c)) {
      game.mg4a = game.mg4a.add(1)
      game.mg4b = game.mg4b.add(1)
      game.mg1a = game.mg1a.sub(game.mg4c)
      game.mg4c = game.mg4c.mul(1.5)
    }
  } else if (game.matter.gte(game["mg"+type+"c"])) {
    game["mg"+type+"a"] = game["mg"+type+"a"].add(1)
    game["mg"+type+"b"] = game["mg"+type+"b"].add(1)
    game.matter = game.matter.sub(game["mg"+type+"c"])
    switch (type) {
      case 1:
        if (game.mg1b.lt(50)) {
          game.mg1c = game.mg1c.add(3)
        } else if (game.mg1b.gt(2250)) {
          game.mg1c = game.mg1c.mul(1.6)
        } else {
          game.mg1c = game.mg1c.mul(1.2)
        }
        break;
      case 2:
        if (game.mg2b.lt(45)) {
          game.mg2c = game.mg2c.add(150)
        } else if (game.mg2b.gt(1600)) {
          game.mg2c = game.mg2c.mul(1.9)
        } else {
          game.mg2c = game.mg2c.mul(1.3)
        }
        break;
      case 4:
        if (game.mg4b.lt(14)) {
          game.mg4c = game.mg4c.add(70)
        } else if (game.mg2b.gt(1700)) {
          game.mg4c = game.mg2c.mul(1.75)
        } else {
          game.mg4c = game.mg2c.mul(1.25)
        }
        break;
      case 5:
        if (game.mg5b.gt(1300)) {
          game.mg5c = game.mg5c.mul(1.8)
        } else {
          game.mg5c = game.mg5c.mul(1.28)
        }
      break;
      case 6:
        if (game.mg6b.gt(970)) {
          game.mg6c = game.mg6c.mul(1.9)
        } else {
          game.mg6c = game.mg6c.mul(1.32)
        }
      break;
      case 3:
        if (game.mg3b.gt(930)) {
          game.mg3c = game.mg3c.mul(2.1)
        } else {
          game.mg3c = game.mg3c.mul(1.5)
        }
      break;
    }
  }
}
function isport() {
  load(prompt("Please enter your save.",""))
}
function esport() {
  prompt("Your save is:",localStorage.getItem("save"))
}
function changec() {
  var clor = prompt("New background color in RGB-Hex (ex: #7B5AD5): (Will reset after a refresh)","")
  document.getElementById("body").style = "background-color: " + clor
}
var rv = Math.round(Math.random() * 255)
var gv = Math.round(Math.random() * 255)
var bv = Math.round(Math.random() * 255)
let intv
var intvon = false
function swapunr() {
  if (intvon) {
    clearInterval(intv)
    intvon = false
    document.getElementById("body").style = "background-color: #FFFFFF"
  } else {
    rv = Math.round(Math.random() * 255)
    gv = Math.round(Math.random() * 255)
    bv = Math.round(Math.random() * 255)
    intv = setInterval(clorr,1)
    intvon = true
  }
}
function clorr() {
  document.getElementById("body").style = "background-color:rgb(" + rv + "," + gv + "," + bv + ")"
  if (rv <= 1) {
    rv = rv + 5
  } else if (rv >= 254) {
    rv = rv - 5
  } else {
    rv = rv + Math.round(Math.random() * 6 - 3)
  }
  if (gv <= 1) {
    gv = gv + 5
  } else if (gv >= 254) {
    gv = gv - 5
  } else {
    gv = gv + Math.round(Math.random() * 6 - 3)
  }
  if (bv <= 1) {
    bv = bv + 5
  } else if (bv >= 254) {
    bv = bv - 5
  } else {
    bv = bv + Math.round(Math.random() * 6 - 3)
  }
}
function buyu(a) {
  switch (a) {
    case 1:
      if (game.atoms.gte(1) && !game.upgrades.u1) {
        game.upgrades.u1 = true
        game.atoms = game.atoms.sub(1)
        game.upgradesbought = game.upgradesbought.add(1)
      }
      break;
    case 2:
      if (game.atoms.gte(2) && !game.upgrades.u2) {
        game.upgrades.u2 = true
        game.atoms = game.atoms.sub(2)
        game.upgradesbought = game.upgradesbought.add(1)
      }
      break;
    case 3:
      if (game.atoms.gte(4) && !game.upgrades.u3) {
        game.upgrades.u3 = true
        game.atoms = game.atoms.sub(4)
        game.upgradesbought = game.upgradesbought.add(1)
      }
      break;
    case 4:
      if (game.atoms.gte(6) && !game.upgrades.u4) {
        game.upgrades.u4 = true
        game.atoms = game.atoms.sub(6)
        game.upgradesbought = game.upgradesbought.add(1)
      }
      break;
    case 5:
      if (game.atoms.gte(3) && game.upgradesbought.gte(4) && !game.upgrades.u5) {
        game.upgrades.u5 = true
        game.atoms = game.atoms.sub(3)
        game.upgradesbought = game.upgradesbought.add(1)
      }
      break;
    case 6:
      if (game.atoms.gte(10) && !game.upgrades.u6) {
        game.upgrades.u6 = true
        game.atoms = game.atoms.sub(10)
        game.upgradesbought = game.upgradesbought.add(1)
      }
      break;
    case 7:
      if (game.atoms.gte(15) && !game.upgrades.u7) {
        game.upgrades.u7 = true
        game.atoms = game.atoms.sub(15)
        game.upgradesbought = game.upgradesbought.add(1)
      }
      break;
    case 8:
      if (game.atoms.gte(20) && !game.upgrades.u8) {
        game.upgrades.u8 = true
        game.atoms = game.atoms.sub(20)
        game.upgradesbought = game.upgradesbought.add(1)
      }
      break;
    case 9:
      if (game.atoms.gte(35) && !game.upgrades.u9) {
        game.upgrades.u9 = true
        game.atoms = game.atoms.sub(35)
        game.upgradesbought = game.upgradesbought.add(1)
      }
      break;
    case 10:
      if (game.atoms.gte(50) && !game.upgrades.u10 && game.upgradesbought.gte(9)) {
        game.upgrades.u10 = true
        game.atoms = game.atoms.sub(50)
        game.upgradesbought = game.upgradesbought.add(1)
        game.auto.tiers[0] = 1
        game.auto.tiers[1] = 1
        game.auto.tiers[2] = 1
        game.auto.tiers[3] = 1
      }
      break;
    case 11:
      if (game.atoms.gte(1e4) && !game.upgrades.u11) {
        game.upgrades.u11 = true
        game.atoms = game.atoms.sub(1e4)
        game.upgradesbought = game.upgradesbought.add(1)
      }
    break;
    case 12:
      if (game.atoms.gte(3.5e4) && !game.upgrades.u12) {
        game.upgrades.u12 = true
        game.atoms = game.atoms.sub(3.5e4)
        game.upgradesbought = game.upgradesbought.add(1)
      }
    break;
    case 13:
      if (game.atoms.gte(1e5) && !game.upgrades.u13) {
        game.upgrades.u13 = true
        game.atoms = game.atoms.sub(1e5)
        game.upgradesbought = game.upgradesbought.add(1)
      }
    break;
    case 14:
      if (game.atoms.gte(2.5e5) && !game.upgrades.u14) {
        game.upgrades.u14 = true
        game.atoms = game.atoms.sub(2.5e5)
        game.upgradesbought = game.upgradesbought.add(1)
      }
    break;
    case 15:
      if (game.atoms.gte(1e7) && !game.upgrades.u15 && game.upgradesbought.gte(14)) {
        game.upgrades.u15 = true
        game.atoms = game.atoms.sub(1e7)
        game.upgradesbought = game.upgradesbought.add(1)
      }
    break;
  }
}
function drag(ev) {
  ev.dataTransfer.setData("text", ev.target.id);
}

function drop(ev) {
  ev.preventDefault();
  var data = ev.dataTransfer.getData("text");
  ev.target.appendChild(document.getElementById(data));
}
function changeFav(newHref) {
  document.head.childNodes[9].href = newHref
}
var f = 0
function animation() {
if (f < 10) {
  f++
} else {
  f = 1
}
  var frame = "f" + f + ".png"
  changeFav(frame)
}
function customfav() {
  if (Math.random() < 0.01) {
    var a = Math.random()
    if (inRange(Math.random(),0.23,0.46)) {
      changeFav("jh.png")
    } else if (inRange(Math.random(),0.46,0.69)) {
      changeFav("marker.png")
    } else if (inRange(Math.random(),0.69,0.92)) {
      changeFav("code.png")
    } else if (inRange(Math.random(),0,0.23)) {
      changeFav("rainbow.png")
    } else if (inRange(Math.random(),0.92,1)) {
      setInterval(animation,1000)
    }
  }
}
customfav()
function inRange(a,b,c) {
  return a>b && a<=c
}
